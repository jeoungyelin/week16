<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¯¸ì†Œë…€ ìŠ¤íƒ€ì¼ ë©”ì´ì»¤</title>
  <link href="https://fonts.googleapis.com/css2?family=Single+Day&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: url('main back.png') no-repeat center/cover;
      font-family: 'Single Day', cursive;
      position: relative;
    }

    /* íƒ€ì´í‹€ ì´ë¯¸ì§€ */
    #title {
      position: absolute;
      top: 15%;
      left: 28%;
      transform: translateX(-50%);
      width: 700px;
    }

    /* ë©”ì¸ ìºë¦­í„° */
    #character {
      position: absolute;
      bottom: 0%;
      right: 0%;
      width: 870px;
      transition: opacity 0.2s ease;
    }
    #character:hover {
      content: url('girl wink.png');
    }

    /* ê²Œì„ ì‹œì‘ ë²„íŠ¼ */
    #startBtn {
      position: absolute;
      bottom: 30%;
      left: 20%;
      width: 250px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #startBtn:hover {
      content: url('Group 2085666353.png');
      transform: scale(1.1);
    }

    /* ê²Œì„ í™”ë©´ ë°°ê²½ */
    #gameBg {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
      top: 0;
      left: 0;
      opacity: 0;
      visibility: hidden;
      transition: opacity 1s ease;
      z-index: 1;
    }

    /* ê²Œì„ ìºë¦­í„° */
    #gameCharacter {
      position: absolute;
      bottom: 10%;
      right: 40%;
      width: 300px;
      opacity: 0;
      transition: 
        opacity 0.6s ease, 
        transform 0.4s ease, 
        bottom 0.7s ease,
        left 0.7s ease;
      cursor: pointer;
      pointer-events: none;
      z-index: 2;
    }
   
    #gameCharacter.show{
      visibility: visible !important;
      opacity: 1 !important;
      pointer-events: auto !important;
    }

    /* hover ì‹œ í™•ëŒ€ */
    #gameCharacter:hover {
      transform: scale(1.1);
    }

    .noHover:hover {
      transform: none !important;
    }

    /* show í´ë˜ìŠ¤: ë¶€ë“œëŸ½ê²Œ í‘œì‹œ */
    .show {
      visibility: visible !important;
      opacity: 1 !important;
    }

    #dialogueBox {
      position: absolute;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);

      width: 95%;
      max-width: 1400px;

      /* â­ í¬ê¸° ê³ ì •ê°’(ì›í•˜ë©´ ì¡°ì ˆ ê°€ëŠ¥) */
      height: 200px;               /* ê³ ì • ë†’ì´ */
      box-sizing: border-box;      /* padding í¬í•¨ ê³„ì‚° */

      padding: 25px 30px;          /* ì•ˆìª½ ì—¬ë°± */

      background: linear-gradient(90deg, #FFE9FD, #ffffff);
      border-radius: 20px;
      outline: 3px dotted #E300EE;
      outline-offset: -5px;
      box-shadow: -2 0 10px 4px rgba(212, 0, 183, 1);

      font-family: 'Single Day', cursive;
      display: none;
      cursor: pointer;
      z-index: 50;

      /* â­ í…ìŠ¤íŠ¸ê°€ ì˜ì—­ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡! */
      overflow: hidden;            /* ë„˜ì¹˜ëŠ” ê¸€ìëŠ” ìˆ¨ê¹€ */
    }

    /* ì´ë¦„: ê·¸ëŒ€ë¡œ ì˜ˆìœ ìŠ¤íƒ€ì¼ ìœ ì§€ */
    #dialogueName {
      font-size: 30px;
      font-weight: bold;
      color: #FFFFFF;
      text-shadow:  -3px 0 0 #E300EE,  /* ì™¼ìª½ */
                     3px 0 0 #E300EE,  /* ì˜¤ë¥¸ìª½ */
                     0 -3px 0 #E300EE, /* ìœ„ */
                     0  3px 0 #E300EE,
                     -3px -3px 0 #E300EE,
                     -3px 3px 0 #E300EE,
                     3px -3px 0 #E300EE,
                     3px 3px 0 #E300EE;

      margin-bottom: 8px;
      white-space: nowrap;         /* ì´ë¦„ì€ ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ì¤„ ìœ ì§€ */
    }

    /* ëŒ€ì‚¬ í…ìŠ¤íŠ¸ */
    #dialogueText {
      font-size: 25px;
      color: #FF00BB;
      line-height: 1.5;
      
      /* â­ ì¤„ë°”ê¿ˆ ìë™ ì²˜ë¦¬ */
      white-space: normal;
      word-break: keep-all;        /* í•œêµ­ì–´ ì¤„ë°”ê¿ˆ ë§¤ë„ëŸ½ê²Œ */
    }

    @keyframes shake {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      20% { transform: translate(calc(-50% - 4px), calc(-50% + 2px)) rotate(-4deg); }
      40% { transform: translate(calc(-50% + 4px), calc(-50% - 3px)) rotate(4deg); }
      60% { transform: translate(calc(-50% - 3px), calc(-50% + 1px)) rotate(-3deg); }
      80% { transform: translate(calc(-50% + 2px), calc(-50% - 2px)) rotate(3deg); }
      100% { transform: translate(-50%, -50%) rotate(0deg); }
    }

    .shake {
      animation: shake 0.4s infinite;
    }

    /* ë°°ê²½ ì „í™˜ìš© í˜ì´ë“œ ì•„ì›ƒ/ì¸ */
    .bg-fade-out {
      opacity: 0 !important;
      transition: opacity 0.8s ease;
    }

    .bg-fade-in {
      opacity: 1 !important;
      transition: opacity 0.8s ease;
    }

    /* ğŸ”Š ê¸€ë¡œë²Œ BGM í† ê¸€ ë²„íŠ¼ */
    #bgmToggle {
      position: fixed;
      top: 2%;
      right: 2%;
      width: 100px;
      height: 100px;
      z-index: 9999;
      cursor: pointer;
    }

    #bgmToggle img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

  </style>
</head>

<body>

    <div id="bgmToggle">
    <img id="bgmIcon" src="Group 2085666441.png">
  </div>

  <!-- ë©”ì¸ í™”ë©´ ìš”ì†Œ -->
  <img id="title" src="head title.png" alt="íƒ€ì´í‹€">
  <img id="character" src="girl main.png" alt="ìºë¦­í„°">
  <img id="startBtn" src="Group 2085666352.png" alt="ê²Œì„í•˜ê¸°">

  <!-- ê²Œì„ í™”ë©´ ìš”ì†Œ -->
  <img id="gameBg" src="5d5a46e4-488f-4ab1-a1ee-0d2d21d7038c 1.png" alt="ê²Œì„ ë°°ê²½">
  <img id="gameCharacter" src="Group 2085666349.png" alt="ê²Œì„ ìºë¦­í„°">

  <div id="dialogueBox">
    <div id="dialogueName">???</div>
    <div id="dialogueText">...</div>
  </div>

  <!-- ì§ˆë¬¸ ì´ë¯¸ì§€ -->
  <img id="qImg" src="" style="display:none; position:absolute; left:50%; top:20%; transform:translateX(-50%); z-index:60;">

  <!-- ì–¸ë‹ˆ ì„ íƒì§€ -->
  <img id="choiceUnni" src="" style="display:none; position:absolute; left:33%; bottom:53%; cursor:pointer; z-index:60;">

  <!-- ì˜¤ë¹  ì„ íƒì§€ -->
  <img id="choiceOppa" src="" style="display:none; position:absolute; left:33%; bottom:40%; cursor:pointer; z-index:61;">

  <!-- ì´ë¦„ ì…ë ¥ UI ì´ë¯¸ì§€ -->
  <img id="nameInputImg" src="Group 2085666393.png"
       style="display:none; position:absolute; left:50%; bottom:400px; transform:translateX(-50%); z-index:58; cursor:pointer;">

  <!-- ì™„ë£Œ ë²„íŠ¼ ê¸°ë³¸ ì´ë¯¸ì§€ -->
  <img id="nameDoneBtn" src="Group 2085666350.png"
       style="display:none; position:absolute; left:50%; bottom:250px; transform:translateX(-50%); z-index:59; cursor:pointer;">

  <!-- ì‹¤ì œ ì…ë ¥ì„ ì²˜ë¦¬í•˜ëŠ” ìˆ¨ê²¨ì§„ input -->
  <input id="hiddenNameInput" type="text" 
         style="position:absolute; opacity:0; z-index:40; pointer-events:none;
          left:50%;
          bottom:450px;
          width:610px;      /* ì…ë ¥ì°½ ê°€ë¡œ í¬ê¸° */
          height:170px; 
          transform:translateX(-50%);">

  <div id="fakeNameText"
       style="
          display:none;
          position:absolute;
          left:50%;
          bottom:460px;
          transform:translateX(-50%);
          z-index:95;
          font-size:45px;
          color:#FF00BB;
          font-family:'Single Day', cursive;
          pointer-events:none;
          text-align:center;
       ">
  </div>

  <!-- ì§‘ ì•ˆ ë°°ê²½ -->
  <img id="roomBg" src="image 110569.png"
       style="display:none; position:absolute; width:100%; height:100%; top:0; left:0; z-index:1;">

  <!-- ë‹«íŒ í¸ì§€ ë´‰íˆ¬ -->
  <img id="letterClosed" src="image 110567.png"
       style="display:none; position:absolute; left:50%; top:50%;
       transform:translate(-50%,-50%); width:850px; z-index:5;">

  <!-- ì—´ë¦° í¸ì§€ ë´‰íˆ¬ -->
  <img id="letterOpen" src="image 110568.png"
       style="display:none; position:absolute; left:15%; top:70%;
       transform:translate(-50%,-50%) rotate(-6deg); width:450px; z-index:6;">

  <!-- í¸ì§€ì§€ -->
 <div id="letterPaper"
       style="
          display:none;
          position:absolute;
          left:40%;
          top:50%;
          transform:translate(-50%, -50%);
          width:720px;
          height:1000px;    /* ë„ˆë¹„ì— ë§ì¶° ì ë‹¹íˆ ë†’ì´ ì¡°ì ˆ */
          background-image:url('Group 2085666402.png');
          background-size:contain;
          background-repeat:no-repeat;
          background-position:center;
          z-index:7;
       ">
  </div>

  <audio id="bgm" src="main bgm.mp3" loop></audio>
  <audio id="clickSfx" src="shine-7-268909.mp3"></audio>
  <audio id="newSfx" src="girl-laugh-6689.mp3"></audio>
  <audio id="shortSfx" src="anime-cat-girl-6731.mp3"></audio>
  <audio id="nameFinishSfx" src="mouse-click-290204.mp3"></audio>
  <audio id="typeSfx" src="alien-talking-312011 (1).mp3"></audio>

<script>

    /* =========================================================
       ğŸ”Š ê¸€ë¡œë²Œ BGM í† ê¸€
    ========================================================= */
    const bgmAudio = document.getElementById('bgm');
    const bgmToggle = document.getElementById('bgmToggle');
    const bgmIcon = document.getElementById('bgmIcon');

    let isBgmPlaying = false;

    bgmToggle.addEventListener('click', () => {
      if (isBgmPlaying) {
        bgmAudio.pause();
        bgmIcon.src = "Group 2085666441.png";   // êº¼ì§„ ì´ë¯¸ì§€
      } else {
        bgmAudio.play();
        bgmIcon.src = "Group 2085666442.png";    // ì¼œì§„ ì´ë¯¸ì§€
      }
      isBgmPlaying = !isBgmPlaying;
    });

    /* =========================================================
       ğŸ”Š ì²« ìƒí˜¸ì‘ìš©ì—ì„œ ìë™ BGM ì‹œì‘ (í•œ ë²ˆë§Œ)
    ========================================================= */
    function tryAutoPlayBgm() {
      if (isBgmPlaying) return;

      bgmAudio.play().then(() => {
        isBgmPlaying = true;
        bgmIcon.src = "Group 2085666442.png"; // ì¼œì§„ ì´ë¯¸ì§€
      }).catch(()=>{});

      document.removeEventListener("pointerdown", tryAutoPlayBgm);
      document.removeEventListener("keydown", tryAutoPlayBgm);
      document.removeEventListener("touchstart", tryAutoPlayBgm);
    }

    document.addEventListener("pointerdown", tryAutoPlayBgm, { once: true });
    document.addEventListener("keydown", tryAutoPlayBgm, { once: true });
    document.addEventListener("touchstart", tryAutoPlayBgm, { once: true });

    /* ======================= */
    /* ğŸƒ í˜¸ëŸ¬ ì´ìŠ¤í„°ì—ê·¸ - ì „ì²´í™”ë©´ */
    /* ======================= */

    let horrorTriggered = false;

    // 5ì´ˆ í›„ í˜¸ëŸ¬ ì´ë¯¸ì§€ í”Œë˜ì‹œ
    setTimeout(() => {
      // ì´ë¯¸ ê²Œì„ ì‹œì‘í–ˆìœ¼ë©´ ì‹¤í–‰ ì•ˆ í•¨
      if (horrorTriggered || gameBg.classList.contains("show")) return;

      horrorTriggered = true;

      // ğŸ”Š ì§€ì§€ì§ê±°ë¦¬ëŠ” ë…¸ì´ì¦ˆ íš¨ê³¼ìŒ
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const bufferSize = audioContext.sampleRate * 0.3; // 0.3ì´ˆ
      const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
      const data = buffer.getChannelData(0);
      for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
      }
      const source = audioContext.createBufferSource();
      source.buffer = buffer;
      source.connect(audioContext.destination);
      source.start(0);

      // ğŸ–¼ í˜¸ëŸ¬ ì˜¤ë²„ë ˆì´ ìƒì„± (í™”ë©´ ì „ì²´)
      const horrorOverlay = document.createElement("img");
      horrorOverlay.src = "Frame 2087327016 (1).png";  // â† í˜¸ëŸ¬ ì´ë¯¸ì§€ íŒŒì¼ëª…
      Object.assign(horrorOverlay.style, {
        position: "fixed",
        top: "0",
        left: "0",
        width: "100vw",
        height: "100vh",
        objectFit: "cover",
        zIndex: "9998",
        pointerEvents: "none",
        filter: "brightness(0.8) contrast(1.5)"
      });
      document.body.appendChild(horrorOverlay);

      // í™”ë©´ í”ë“¤ë¦¼ íš¨ê³¼
      document.body.style.animation = "none";
      setTimeout(() => {
        document.body.style.animation = "screenShake 0.15s infinite";
      }, 10);

      // 0.3ì´ˆ í›„ í˜¸ëŸ¬ ì´ë¯¸ì§€ ì œê±° ë° ë³µêµ¬
      setTimeout(() => {
        horrorOverlay.style.opacity = "0";
        horrorOverlay.style.transition = "opacity 0.1s ease";
        
        setTimeout(() => {
          horrorOverlay.remove();
          document.body.style.animation = "none";
        }, 100);
      }, 300);

    }, 4000);

    /* í™”ë©´ í”ë“¤ë¦¼ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
    const style = document.createElement('style');
    style.textContent = `
      @keyframes screenShake {
        0% { transform: translate(0, 0); }
        25% { transform: translate(-5px, -5px); }
        50% { transform: translate(5px, 5px); }
        75% { transform: translate(-5px, 5px); }
        100% { transform: translate(5px, -5px); }
      }
    `;
    document.head.appendChild(style);


    /* =========================================================
       ğŸ® ì£¼ìš” ìš”ì†Œ
    ========================================================= */
    const title = document.getElementById('title');
    const character = document.getElementById('character');
    const startBtn = document.getElementById('startBtn');
    const gameBg = document.getElementById('gameBg');
    const gameCharacter = document.getElementById('gameCharacter');

    const dialogueBox = document.getElementById('dialogueBox');
    const dialogueName = document.getElementById('dialogueName');
    const dialogueText = document.getElementById('dialogueText');

    const qImg = document.getElementById("qImg");
    const choiceUnni = document.getElementById("choiceUnni");
    const choiceOppa = document.getElementById("choiceOppa");

    const nameInputImg = document.getElementById("nameInputImg");
    const nameDoneBtn = document.getElementById("nameDoneBtn");
    const hiddenNameInput = document.getElementById("hiddenNameInput");
    const fakeNameText = document.getElementById("fakeNameText");

    /* í¸ì§€ ìš”ì†Œ */
    const letterClosed = document.getElementById("letterClosed");
    const letterOpen = document.getElementById("letterOpen");
    const letterPaper = document.getElementById("letterPaper");

    /* =========================================================
       ğŸŒ¸ í”Œë ˆì´ì–´ ì„¤ì •
    ========================================================= */
    let playerTitle = "";
    let playerName = "";

    /* =========================================================
       ğŸ’¬ ëŒ€ì‚¬ ë°ì´í„°
    ========================================================= */
    const dialogue = [
      { name: "ì •ì²´ ëª¨ë¥¼ ì†Œë…€", text: "ì•ˆë…•? ë§Œë‚˜ì„œ ë°˜ê°€ì›Œ :) ìê¸°ì†Œê°œë¥¼ í•´ì¤„ë˜?" },

      { name: "ì •ì²´ ëª¨ë¥¼ ì†Œë…€", text: "ë‚˜í•œí…Œ {{title}} ê°€ ìˆì—ˆë‹¤ë‹ˆ!! ë‚˜ëŠ”... ë‚´ ê°€ì¡±ì´ ë‹¤ ì£½ì€ ì¤„ë¡œë§Œ ì•Œì•˜ê±°ë“ " },
      { name: "ì •ì²´ ëª¨ë¥¼ ì†Œë…€", text: "ì´ë ‡ê²Œ {{title}}ë‘ ì–˜ê¸°í•  ìˆ˜ ìˆë‹¤ë‹ˆ ë‚˜ ë„ˆë¬´ ê¸°ë»!" },

      { name: "ì •ì²´ ëª¨ë¥¼ ì†Œë…€", text: "{{title}}, ê·¸ëŸ¼ í˜¹ì‹œ... ë‚´ ì´ë¦„ë„ ì˜ˆì˜ê²Œ ì§€ì–´ì¤„ ìˆ˜ ìˆì–´?" },

      { name: "{{name}}", text: "ê³ ë§ˆì›Œ! ì •ë§ ë§ˆìŒì— ë“¤ì–´ :)" },
      { name: "{{name}}", text: "ì–´ì„œ ì™€, {{title}}. ì—¬ê¸°ëŠ” ë‚´ê°€ ì§€ë‚´ë˜ ì§‘ì´ì•¼" },
      { name: "{{name}}", text: "ì´ì œëŠ” í˜¼ìê°€ ì•„ë‹ˆë¼ 'ìš°ë¦¬'ì˜ ì§‘ì´ê¸°ë„ í•˜ì§€ë§Œ...!" },
      { name: "{{name}}", text: "ì•„- ë§ë‹¤. ë¬¸ í‹ˆì— ìš°í¸ì´ ì”ëœ© ìŒ“ì—¬ ìˆì–´" },
      { name: "{{name}}", text: "í™•ì¸í•˜ëŠ” ê±¸ ìê¾¸ë§Œ ê¹Œë¨¹ì§€ ë­ì•¼..." }
    ];

    /* =========================================================
       ğŸ’¬ í¸ì§€ ì´í›„ ëŒ€ì‚¬
    ========================================================= */
    const postLetterDialogue = [
      { name: "{{name}}", text: "ìš°ì™€! {{title}}, ë‚˜ë„ íŒŒí‹°ì— ê°€ê³  ì‹¶ì–´!" },
      { name: "{{name}}", text: "ê·¼ë°â€¦ íŒŒíŠ¸ë„ˆê°€ ê¼­ í•„ìš”í•˜ë‹¤ë‹ˆâ€¦" },
      { name: "{{name}}", text: "íŒŒíŠ¸ë„ˆì—ê²Œ ì„ íƒë°›ê¸° ìœ„í•´ì„œëŠ” ì˜ˆì˜ê²Œ ê¾¸ë©°ì•¼ í•  ê²ƒ ê°™ì•„" },
      { name: "{{name}}", text: "{{title}}, ë‚˜ë¥¼ ì¢€ ë„ì™€ì¤„ ìˆ˜ ìˆì–´?" }
    ];

    let postIndex = 0;
    let isPostLetterScene = false;
    let currentDialogueIndex = 0;

    /* =========================================================
       â–¶ ê²Œì„ ì‹œì‘
    ========================================================= */
    startBtn.addEventListener('click', () => {
      title.style.display = "none";
      character.style.display = "none";
      startBtn.style.display = "none";

      document.body.style.background = "none";

      gameBg.classList.add("show");

      setTimeout(() => {
        gameCharacter.classList.add("show");
      }, 900);
    });

    /* =========================================================
       â–¶ ì²« í´ë¦­ â†’ ëŒ€í™” ì‹œì‘ + íš¨ê³¼ìŒ(ì¡°ê±´ë¬¸ ì—†ìŒ)
    ========================================================= */
    function onCharacterClick() {

      if (!gameBg.classList.contains("show")) return;

      // ğŸ”Š íš¨ê³¼ìŒ ì¬ìƒ (ì¡°ê±´ ì—†ì´ ë°”ë¡œ!)
      const clickSfx = document.getElementById("clickSfx");
      if (clickSfx) {
        clickSfx.currentTime = 0;
        clickSfx.play();
      }

      // â­ ëŒ€í™” ì‹œì‘
      dialogueBox.style.display = "block";
      currentDialogueIndex = 0;
      renderDialogue();

      // í•œë²ˆ í´ë¦­í•œ í›„ hover íš¨ê³¼ ì œê±°
      gameCharacter.classList.add("noHover");
      gameCharacter.removeEventListener("click", onCharacterClick);
    }

    gameCharacter.addEventListener("click", onCharacterClick);

    /* =========================================================
       ğŸ§  ëŒ€ì‚¬ ë Œë”ë§
    ========================================================= */
    function renderDialogue() {
      let line = dialogue[currentDialogueIndex].text;
      let speaker = dialogue[currentDialogueIndex].name;

      line = line.replace(/{{title}}/g, playerTitle);
      line = line.replace(/{{name}}/g, playerName);

      speaker = speaker.replace(/{{title}}/g, playerTitle);
      speaker = speaker.replace(/{{name}}/g, playerName);

      dialogueName.textContent = speaker;
      dialogueText.textContent = line;
    }


    /* =========================================================
       â–¶ ëŒ€í™” í´ë¦­ íë¦„ ì „ì²´
    ========================================================= */
    let isHorrorPlaying = false;  // ğŸ”¹ ì´ ì¤„ì„ addEventListener ë°”ë¡œ ìœ„ì— ì¶”ê°€!

    dialogueBox.addEventListener("click", () => {
      // ğŸ”¹ í˜¸ëŸ¬ ì˜ìƒ ì¬ìƒ ì¤‘ì´ë©´ í´ë¦­ ë¬´ì‹œ
      if (isHorrorPlaying) return;

      /* ğŸ”Š ì—¬ê¸°! â€” ëŒ€ì‚¬ í´ë¦­í•  ë•Œ ì¬ìƒë˜ëŠ” 2ì´ˆ ì§œë¦¬ íš¨ê³¼ìŒ ë„£ëŠ” ìë¦¬ */
      if (currentDialogueIndex === 1) {
        const shortSfx = document.getElementById("shortSfx");
        shortSfx.currentTime = 0.5;
        shortSfx.play();

        setTimeout(() => {
          shortSfx.pause();
          shortSfx.currentTime = 0;
        }, 1500);
      }

      if (isPostLetterScene) {
        showPostDialogue();
        return;
      }

      if (currentDialogueIndex === 0) {
        dialogueBox.style.display = "none";
        qImg.src = "Group 2085666357.png";
        choiceUnni.src = "Group 2085666360.png";
        choiceOppa.src = "Group 2085666361.png";

        qImg.style.display = "block";
        choiceUnni.style.display = "block";
        choiceOppa.style.display = "block";
        return;
      }

      if (currentDialogueIndex === 3) {
        dialogueBox.style.display = "none";
        dialogueBox.style.pointerEvents = "none";
        nameInputImg.style.display = "block";
        nameDoneBtn.style.display = "block";
        return;
      }

      if (currentDialogueIndex === dialogue.length - 1) {
        showLetterScene();
        return;
      }

      // ğŸ”¹ 1ë²ˆ ëŒ€ì‚¬ í´ë¦­ ì‹œ í˜¸ëŸ¬ ë¹„ë””ì˜¤ ì¬ìƒ (ì´ ë¶€ë¶„ ì¶”ê°€)
      if (currentDialogueIndex === 1) {
        triggerDialogueHorror();
        return;
      }

      currentDialogueIndex++;
      renderDialogue();
    });

    /* ========= ìˆ˜ì • ìœ„ì¹˜ 4 (ìƒˆë¡œ ì¶”ê°€) ========= */
    /* dialogueBox.addEventListener í•¨ìˆ˜ê°€ ëë‚œ í›„ (ì•½ 550ì¤„)
       showPostDialogue() í•¨ìˆ˜ ë°”ë¡œ ìœ„ì— ì´ í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì„¸ìš”! */

    function triggerDialogueHorror() {
      isHorrorPlaying = true;
      dialogueBox.style.display = "none";

      const horrorSfx = new Audio("scary-horror-sound-189949 (1).mp3");
      horrorSfx.volume = 1;
      horrorSfx.currentTime = 1;
      horrorSfx.play();

      setTimeout(() => {
        horrorSfx.pause();
      }, 1700);

      const horrorVideo = document.createElement("video");
      horrorVideo.src = "kingzzang____--ar_32_--video_1_22339c0a-1185-44d4-9e17-39e313b60813_0 (1).mp4";
      Object.assign(horrorVideo.style, {
        position: "fixed",
        top: "0",
        left: "0",
        width: "100vw",
        height: "100vh",
        objectFit: "cover",
        zIndex: "9997",
        pointerEvents: "none"
      });
      
      horrorVideo.muted = false;
      horrorVideo.autoplay = true;
      document.body.appendChild(horrorVideo);

      // ğŸ”¹ 4ì´ˆ ë™ì•ˆ ë¶ˆê·œì¹™í•˜ê²Œ ê¹œë¹¡ê±°ë¦¼
      const startTime = Date.now();
      const endTime = startTime + 1500;

      function flicker() {
        if (Date.now() > endTime) {
          // 4ì´ˆ ì¢…ë£Œ - ì˜ìƒ ì œê±°
          horrorVideo.remove();
          isHorrorPlaying = false;
          
          currentDialogueIndex++;
          renderDialogue();
          dialogueBox.style.display = "block";
          return;
        }

        // ğŸ”¹ ë¶ˆê·œì¹™í•œ ê°„ê²©ìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤ ì‚¬ë¼ì¡Œë‹¤
        const randomShowTime = Math.random() * 150 + 50;  // 100~300ms í‘œì‹œ
        const randomHideTime = Math.random() * 100 + 50;   // 50~200ms ìˆ¨ê¹€

        horrorVideo.style.display = "block";
        
        setTimeout(() => {
          horrorVideo.style.display = "none";
          
          setTimeout(() => {
            flicker();  // ì¬ê·€ì ìœ¼ë¡œ ê³„ì† ë°˜ë³µ
          }, randomHideTime);
        }, randomShowTime);
      }

      flicker();
    }  // ğŸ”¹ í•¨ìˆ˜ ì¢…ë£Œ ê´„í˜¸

    /* =========================================================
       ğŸ©· ì„ íƒì§€
    ========================================================= */
    function hideChoices() {
      qImg.style.display = "none";
      choiceUnni.style.display = "none";
      choiceOppa.style.display = "none";
    }

    choiceUnni.addEventListener("click", () => {

  const nameFinishSfx = document.getElementById("nameFinishSfx");
  if (nameFinishSfx) {
    nameFinishSfx.currentTime = 0;
    nameFinishSfx.play();
  }


      playerTitle = "ì–¸ë‹ˆ";
      hideChoices();
      dialogueBox.style.display = "block";
      currentDialogueIndex = 1;
      renderDialogue();
    });

      const nameFinishSfx = document.getElementById("nameFinishSfx");
  if (nameFinishSfx) {
    nameFinishSfx.currentTime = 0;
    nameFinishSfx.play();
  }

    choiceOppa.addEventListener("click", () => {
      playerTitle = "ì˜¤ë¹ ";
      hideChoices();
      dialogueBox.style.display = "block";
      currentDialogueIndex = 1;
      renderDialogue();
    });

    /* =========================================================
       ğŸŒ¸ ì´ë¦„ ì…ë ¥
    ========================================================= */
    nameInputImg.addEventListener("click", () => {
      fakeNameText.style.display = "block";
      hiddenNameInput.value = "";
      fakeNameText.textContent = "";
      hiddenNameInput.focus();
    });

    hiddenNameInput.addEventListener("input", () => {
      fakeNameText.textContent = hiddenNameInput.value;
    });

    nameDoneBtn.addEventListener("mouseenter", () => {
      nameDoneBtn.src = "Group 2085666351.png";
    });
    nameDoneBtn.addEventListener("mouseleave", () => {
      nameDoneBtn.src = "Group 2085666350.png";
    });

    nameDoneBtn.addEventListener("click", () => {
      const finalName = hiddenNameInput.value.trim();
      if (!finalName) return;

        /* ğŸ”Š ì—¬ê¸°! ì´ë¦„ ì…ë ¥ ì™„ë£Œ íš¨ê³¼ìŒ */
      const nameFinishSfx = document.getElementById("nameFinishSfx");
      nameFinishSfx.currentTime = 0;
      nameFinishSfx.play();

        const newSfx = document.getElementById("newSfx");
        newSfx.currentTime = 0;
        newSfx.play();

      playerName = finalName;

      localStorage.setItem("playerName", playerName);
      localStorage.setItem("playerTitle", playerTitle);

      gameCharacter.style.opacity = "0";

      setTimeout(() => {
        gameCharacter.src = "Group 2085666366.png";
        gameCharacter.style.width = "500px";
        gameCharacter.style.bottom = "8%";
        gameCharacter.style.right = "32%";
      }, 50);

      setTimeout(() => {
        gameCharacter.style.opacity = "1";
      }, 450);

      fakeNameText.style.display = "none";
      nameInputImg.style.display = "none";
      nameDoneBtn.style.display = "none";

      dialogueBox.style.pointerEvents = "auto";
      dialogueBox.style.display = "block";

      currentDialogueIndex = 4;
      renderDialogue();
    });

    /* =========================================================
       ğŸ’Œ ì§‘ ë‚´ë¶€ í™”ë©´ + í¸ì§€
    ========================================================= */
    let letterClickCount = 0;
    let letterTypingDone = false;

    function showLetterScene() {
      dialogueBox.style.display = "none";
      gameCharacter.style.display = "none";

      gameBg.classList.add("bg-fade-out");

      setTimeout(() => {
        gameBg.src = "image 110569.png";
        gameBg.classList.remove("bg-fade-out");
        gameBg.classList.add("bg-fade-in");
      }, 400);

      setTimeout(() => {
        letterClosed.style.display = "block";
        letterClosed.classList.add("shake");
      }, 900);

      document.body.addEventListener("click", letterClickLogic);
    }

    /* =========================================================
       ğŸ’Œ í¸ì§€ ì• ë‹ˆë©”ì´ì…˜ ë‹¨ê³„
    ========================================================= */
    function letterClickLogic() {
      letterClickCount++;

      if (letterClickCount === 4) {
        letterClosed.classList.remove("shake");
        letterClosed.style.opacity = "0";

        letterOpen.style.display = "block";
        letterOpen.style.opacity = "0";

        setTimeout(() => {
          letterOpen.style.transition = "opacity 0.5s ease";
          letterOpen.style.opacity = "1";
        }, 200);
      }

      if (letterClickCount === 5) {

          // ğŸ”Š ì—¬ê¸°! í´ë¦­ ìˆœê°„ = ì˜¤ë””ì˜¤ ê¶Œí•œ íšë“ ê°€ëŠ¥
      const crackle = new Audio("alien-talking-312011 (1).mp3");
      crackle.volume = 0;    // ì†Œë¦¬ ì•ˆ ë‚˜ê²Œ
      crackle.play().catch(()=>{});

      // ğŸ”Š 2) 0.5ì´ˆ í›„ ì‹¤ì œ ë³¼ë¥¨ìœ¼ë¡œ ë‹¤ì‹œ ì¬ìƒ
      setTimeout(() => {
        crackle.pause();
        crackle.currentTime = 0;
        crackle.volume = 1;
        crackle.play();
      }, 500); // â† 0.5ì´ˆ ë’¤

        letterPaper.style.display = "block";
        letterPaper.style.opacity = "0";

        setTimeout(() => {
          letterPaper.style.transition = "opacity 0.5s ease";
          letterPaper.style.opacity = "1";

          setTimeout(() => {
            showLetterContents();
          }, 500);

        }, 250);
      }
    }

    /* =========================================================
       ğŸ’Œ ì œëª© + íƒ€ì´í•‘ í‘œì‹œ
    ========================================================= */
    function showLetterContents() {
      const paper = letterPaper;

      const titleImg = document.createElement("img");
      titleImg.src = "Group 2085666403.png";
      Object.assign(titleImg.style, {
        width: "70%",
        position: "absolute",
        top: "170px",
        left: "50%",
        transform: "translateX(-50%)",
        opacity: "0",
        transition: "opacity 1.5s ease",
        pointerEvents: "none",
        zIndex: "90"
      });
      paper.appendChild(titleImg);

      const textBox = document.createElement("div");
      Object.assign(textBox.style, {
        position: "absolute",
        top: "300px",
        left: "50%",
        transform: "translateX(-50%)",
        width: "80%",
        fontSize: "24px",
        color: "#630095",
        fontFamily: "'Single Day', cursive",
        lineHeight: "1.5",
        whiteSpace: "pre-line",
        pointerEvents: "none",
        zIndex: "90",
        textAlign: "center"
      });
      paper.appendChild(textBox);

      setTimeout(() => {
        titleImg.style.opacity = "1";
      }, 100);

      const letterContent = [
        { text: "ë‹¹ì‹ ì„ ë§¤ë‹¬ ê°œìµœí•˜ëŠ”", style: "font-size:45px; color:#630095; font-weight:bold;" },
        { text: "ê³µì£¼íŒŒí‹°ì— ì´ˆëŒ€í•©ë‹ˆë‹¤", style: "font-size:45px; color:#630095; font-weight:bold;" },
        { text: ".", style: "" },
        { text: ".", style: "" },
        { text: "ì‹œê°„: ì˜¤ëŠ˜ ë°¤ 7ì‹œ", style: "font-size:30px; color:#630095;" },
        { text: "ì¥ì†Œ: í•‘í¬ë¹› íŒŒí‹°ë£¸", style: "font-size:30px; color:#630095;" },
        { text: "ë“œë ˆìŠ¤ ì½”ë“œ: ë‚¨ë“¤ë³´ë‹¤ ë” ì˜ˆì˜ê²Œ", style: "font-size:30px; color:#630095;" },
        { text: "ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡ã…¡", style: "color:#CECECE" },
        { text: "â€»", style: "color:#F80000" },
        { text: "ë‹¨, íŒŒíŠ¸ë„ˆê°€ ì—†ìœ¼ë©´ ì°¸ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", style: "font-size:35px; color:#F80000; font-weight:bold;" }
      ];

      typeWriterParagraph(textBox, letterContent, 35);
    }

    /* =========================================================
       ğŸ“ ë¬¸ë‹¨ë³„ íƒ€ì´í•‘ íš¨ê³¼
    ========================================================= */
    function typeWriterParagraph(element, paragraphList, speed) {
      let pIndex = 0;
      let cIndex = 0;

      let currentLine = document.createElement("div");
      currentLine.style.cssText = paragraphList[0].style;
      element.appendChild(currentLine);

      function typing() {

        let line = paragraphList[pIndex].text;

        if (cIndex < line.length) {
          currentLine.textContent += line[cIndex];
          cIndex++;
          setTimeout(typing, speed);
          return;
        }

        // í•œ ì¤„ ëë‚¨
        pIndex++;
        cIndex = 0;

        // ëª¨ë“  ì¤„ ëë‚¬ìŒ â†’ ì—¬ê¸°ì„œ true
        if (pIndex >= paragraphList.length) {
          letterTypingDone = true;
          return;
        }

        // ë‹¤ìŒ ì¤„ ìƒì„±
        currentLine = document.createElement("div");
        currentLine.style.cssText = paragraphList[pIndex].style;
        element.appendChild(currentLine);

        setTimeout(typing, speed + 200);
      }

      typing();
    }

    /* =========================================================
       (ê¸°ì¡´) ë‹¨ìˆœ ë¬¸ìì—´ íƒ€ì´í•‘
    ========================================================= */
    function typeWriter(element, text, speed) {
      let i = 0;
      function typing() {
        if (i < text.length) {
          element.textContent += text[i];
          i++;
          setTimeout(typing, speed);
        }
      }
      typing();
    }

    /* =========================================================
       ğŸ’¬ í¸ì§€ í´ë¦­ â†’ ìƒˆë¡œìš´ ëŒ€ì‚¬ ì‹œì‘
    ========================================================= */
    letterPaper.addEventListener("click", () => {

      if (!letterTypingDone) return;  // íƒ€ì´í•‘ ëë‚˜ì•¼ ë‹¤ìŒ ì§„í–‰

      dialogueBox.style.display = "block";

      isPostLetterScene = true;
      postIndex = 0;

      showPostDialogue();
    });

    /* =========================================================
       ğŸ’¬ í¸ì§€ ì´í›„ ëŒ€ì‚¬ ì¬ìƒ
    ========================================================= */
    function showPostDialogue() {
      if (postIndex >= postLetterDialogue.length) {
        // ğŸ”¹ ëª¨ë“  ëŒ€ì‚¬ê°€ ëë‚˜ë©´ ë²„íŠ¼ í‘œì‹œ
        showNextSceneButton();
        return;
      }

      let line = postLetterDialogue[postIndex].text;
      let speaker = postLetterDialogue[postIndex].name;

      line = line.replace(/{{title}}/g, playerTitle);
      line = line.replace(/{{name}}/g, playerName);
      speaker = speaker.replace(/{{title}}/g, playerTitle);
      speaker = speaker.replace(/{{name}}/g, playerName);

      dialogueName.textContent = speaker;
      dialogueText.textContent = line;

      postIndex++;
    }

function showNextSceneButton() {
      // 1) ê¸°ì¡´ í™”ë©´ ì •ë¦¬
      dialogueBox.style.display = "none";
      letterPaper.style.display = "none";
      letterOpen.style.display = "none";
      letterClosed.style.display = "none";

      // 2) ë²„íŠ¼ ë§Œë“¤ê¸°
      const nextBtn = document.createElement("img");
      nextBtn.src = "Group 2085666405.png"; // ë²„íŠ¼ ì´ë¯¸ì§€ íŒŒì¼ëª…
      Object.assign(nextBtn.style, {
        position: "absolute",
        left: "50%",
        top: "50%",
        transform: "translateX(-50%)",
        width: "800px",
        cursor: "pointer",
        zIndex: "100"
      });

      document.body.appendChild(nextBtn);

      // 3) í´ë¦­í•˜ë©´ íš¨ê³¼ìŒ 2ê°œ + í˜¸ëŸ¬ íš¨ê³¼ + íŒŒì¼ ì´ë™
      nextBtn.addEventListener("click", () => {
        // ğŸ”Š íš¨ê³¼ìŒ 1 - ì„ íƒ íš¨ê³¼ìŒ
        const nameFinishSfx = document.getElementById("nameFinishSfx");
        if (nameFinishSfx) {
          nameFinishSfx.currentTime = 0;
          nameFinishSfx.play();
        }

       // ğŸ”Š ì§€ì§ê±°ë¦¬ëŠ” í™”ì´íŠ¸ ë…¸ì´ì¦ˆ íš¨ê³¼ìŒ
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const bufferSize = audioContext.sampleRate * 0.5;
      const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
      const data = buffer.getChannelData(0);

      for (let i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
      }

      const noise = audioContext.createBufferSource();
      noise.buffer = buffer;
      noise.connect(audioContext.destination);
      noise.start(0);

        // ğŸ”¹ í˜¸ëŸ¬ ì´ë¯¸ì§€ í”Œë˜ì‹œ
        const horrorOverlay = document.createElement("img");
        horrorOverlay.src = "Frame 2087327017 (1).png";  // í˜¸ëŸ¬ ì´ë¯¸ì§€
        Object.assign(horrorOverlay.style, {
          position: "fixed",
          top: "0",
          left: "0",
          width: "100vw",
          height: "100vh",
          objectFit: "cover",
          zIndex: "9998",
          pointerEvents: "none"
        });
        document.body.appendChild(horrorOverlay);

        // 0.3ì´ˆ í›„ ì œê±° ë° íŒŒì¼ ì´ë™
        setTimeout(() => {
          horrorOverlay.remove();
          window.location.href = "closet.html";  // ì´ë™í•  íŒŒì¼ ì´ë¦„
        }, 500);
      });
    }

</script>

</body>
</html>