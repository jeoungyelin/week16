<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>íŒŒí‹° ì´ë™ & íŒŒí‹°ì¥</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Single+Day&display=swap" rel="stylesheet">

<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{width:100vw;height:100vh;overflow:hidden;background:#000;}

  #transitionScreen{
    position:absolute;width:100%;height:100%;
    background:url("Frame 2087327012.png") no-repeat center/cover;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    font-family:'Single Day',cursive;z-index:5;
  }

  #transitionText{
    font-size:40px;color:#FFB7F2;
    text-shadow:-2px 0 #FF3CC2,2px 0 #FF3CC2,0 2px #FF3CC2,0 -2px #FF3CC2;
  }

  #partyScreen{
    display:none;position:absolute;width:100%;height:100%;overflow:hidden;
  }

  #partyBg{
    position:absolute;width:100%;height:100%;object-fit:cover;
  }

  #playerChar{
    position:absolute;width:120px;
    bottom:40px;left:50%;transform:translateX(-50%);
    z-index:10;
  }

  .npc{
    position:absolute;width:110px;z-index:8;
  }

    /* ğŸ”¥ ì›ë¹ˆ ì‹¤ì‚¬ ì´ë¯¸ì§€ */
  #introBinImg{
    position:absolute;
    width:420px;
    right:50%; top:0%;
    transform:translateX(50%);
    z-index:20;
    display:none;
  }

  .dialogueBox{
    position:absolute;left:50%;bottom:20px;transform:translateX(-50%);
    width:95%;max-width:1400px;height:200px;padding:25px 30px;
    background:linear-gradient(90deg,#FFE9FD,#fff);
    border-radius:20px;outline:3px dotted #E300EE;outline-offset:-5px;
    box-shadow:-2 0 10px 4px rgba(212,0,183,1);
    font-family:'Single Day',cursive;cursor:pointer;
    display:none;flex-direction:column;z-index:20;
  }

  #dialogueName{
    font-size:30px;font-weight:bold;color:#fff;
    text-shadow:-3px 0 #E300EE,3px 0 #E300EE,0 -3px #E300EE,0 3px #E300EE,
                -3px -3px #E300EE,-3px 3px #E300EE,3px -3px #E300EE,3px 3px #E300EE;
    margin-bottom:8px;white-space:nowrap;
  }

  #dialogueText{
    font-size:25px;color:#FF00BB;line-height:1.5;
    white-space:normal;word-break:keep-all;
  }

  /* ======================= */
  /* âœ… ê·€ê°€ ì»·ì‹ (ì˜ìƒ ì˜¤ë²„ë ˆì´) */
  /* ======================= */

  #goHomeScreen{
    display:none;
    position:absolute;
    width:100%;height:100%;
    overflow:hidden;
    z-index:30; /* party ìœ„ë¡œ */
  }

  /* âœ… í™”ë©´ì„ ë®ëŠ” ì˜ìƒ */
  #goHomeVideo{
    position:absolute;
    left:0; top:0;
    width:100%; height:100%;
    object-fit:cover;
    z-index:1;
  }

  /* âœ… ì˜ìƒ ìœ„ ìºë¦­í„° */
  #goHomePlayer{
    position:absolute;
    width:540px;   /* ì—¬ê¸°ì„œ í¬ê¸° ì¡°ì ˆ */
    left:18%;      /* ì—¬ê¸°ì„œ ìœ„ì¹˜ ì¡°ì ˆ */
    top:0px;   /* ì—¬ê¸°ì„œ ìœ„ì¹˜ ì¡°ì ˆ */
    z-index:5;
    image-rendering: pixelated;
  }

  /* âœ… ê·€ê°€ ì»·ì‹  ì „ìš© ëŒ€í™”ì°½ì€ ê¸°ì¡´ dialogueBoxë¥¼ ê·¸ëŒ€ë¡œ ì“°ë˜ */
  #goHomeDialogue{
    z-index:10;
  }

    /* âœ… ê·€ê°€ ì»·ì‹  ëŒ€í™” ì´ë¦„/í…ìŠ¤íŠ¸ë¥¼ ê¸°ì¡´ ëŒ€í™”ì°½ê³¼ ë™ì¼í•˜ê²Œ */
  #goHomeName{
    font-size:30px;font-weight:bold;color:#fff;
    text-shadow:-3px 0 #E300EE,3px 0 #E300EE,0 -3px #E300EE,0 3px #E300EE,
                -3px -3px #E300EE,-3px 3px #E300EE,3px -3px #E300EE,3px 3px #E300EE;
    margin-bottom:8px;white-space:nowrap;
  }

  #goHomeText{
    font-size:25px;color:#FF00BB;line-height:1.5;
    white-space:normal;word-break:keep-all;
  }

  /* ğŸ«¨ ê·€ê°€ ìºë¦­í„° ë°”ë“¤ë°”ë“¤ */
@keyframes shiver {
  0%   { transform: translate(0, 0) rotate(0deg); }
  25%  { transform: translate(-0.4px, 0.4px) rotate(-0.2deg); }
  50%  { transform: translate(0.4px, -0.4px) rotate(0.2deg); }
  75%  { transform: translate(-0.3px, 0px) rotate(-0.15deg); }
  100% { transform: translate(0, 0) rotate(0deg); }
}

#goHomePlayer.shiver {
  animation: shiver 0.22s infinite;
  transform-origin: 50% 80%;
}

/* ì ‘ê·¼ì„± ì˜µì…˜ */
@media (prefers-reduced-motion: reduce) {
  #goHomePlayer.shiver { animation: none; }
}

  /* í˜¼ì£ë§ ì „ìš©(ê°™ì€ dialogueBox ì¬ì‚¬ìš©) */

</style>
</head>

<body>

<div id="transitionScreen">
  <div id="transitionText">íŒŒí‹°ì¥ìœ¼ë¡œ ì´ë™ ì¤‘â€¦</div>
</div>

<div id="partyScreen">
  <img id="partyBg" src="Frame 2087327013.png">
  <img id="playerChar" src="kingzzang__very_tiny_pixel_art_sprite_16x16_pixel_character_ext_b71ac461-14bb-4569-a979-122d07f13139.png" style="left:320px;bottom:120px;">

  <!-- pixel NPCë“¤ (2 ì—¬ì + 1 ë‚¨ì + ì›ë¹ˆ) -->
  <img id="npc1" class="npc" src="Group 2085666449.png" style="right:4%;bottom:60px;">
  <img id="npc2" class="npc" src="kingzzangtiny.png" style="left:73%;top:100px;width:150px;">
  <img id="npc3" class="npc" src="kingzzangultra.png"   style="left:28%;bottom:470px;width:125px;">
  <img id="npcBin" class="npc" src="Group 2085666450.png"  style="left:12%;bottom:120px;">

  <img id="introBinImg" src="Group 2085666447.png">

  <!-- ëŒ€í™” ì¤‘ NPC ì´ë¯¸ì§€ í‘œì‹œ -->
<img id="dialogueCharImg" style="
  position:absolute;
  right:50px;
  bottom:250px;
  width:350px;
  z-index:19;
  display:none;
">

  <!-- ëŒ€í™”ì°½ -->
  <div id="dialogueBox" class="dialogueBox">
    <div id="dialogueName"></div>
    <div id="dialogueText"></div>
  </div>

</div>

<!-- ======================= -->
<!-- âœ… ê·€ê°€ ì»·ì‹ (ì˜ìƒ ë®ê¸° + í˜¼ì£ë§) -->
<!-- ======================= -->
<div id="goHomeScreen">

  <!-- âœ… í™”ë©´ì„ ë®ëŠ” ì˜ìƒ(íŒŒì¼ëª…ë§Œ ë„ˆ ì˜ìƒìœ¼ë¡œ ë°”ê¿”) -->
  <video id="goHomeVideo" src="kjh.mp4" autoplay muted playsinline loop></video>

  <!-- âœ… ì˜ìƒ ìœ„ ìºë¦­í„° ì´ë¯¸ì§€(ì •ì§€ ì»·ì´ë©´ ë” ì¢‹ìŒ) -->
  <img id="goHomePlayer" src="Group 2085666455 (1).png" alt="">

  <!-- âœ… í˜¼ì£ë§ ëŒ€í™”ì°½ -->
  <div id="goHomeDialogue" class="dialogueBox" style="display:flex;">
    <div id="goHomeName"></div>
    <div id="goHomeText"></div>
  </div>

</div>

  <!-- ğŸ”Š íŒŒí‹° BGM -->
<audio id="partyBgm" loop preload="auto">
  <source src="zombie-party-time-124560 (1).mp3" type="audio/mpeg">
</audio>

<!-- ğŸ”Š íŒŒí‹° BGM 2 (ì¶”ê°€) -->
<audio id="partyBgm2" loop preload="auto">
  <source src="house-party-inside-voices-talking-10-62063 (1).mp3" type="audio/mpeg">
</audio>

<!-- ğŸ‘£ ì´ë™ íš¨ê³¼ìŒ -->
<audio id="walkSfx" src="walking-in-heels-95578.mp3" preload="auto"></audio>

<!-- ğŸ  ê·€ê°€ BGM -->
<audio id="goHomeBgm" loop preload="auto">
  <source src="passing-car-393073 (1).mp3" type="audio/mpeg">
</audio>

<!-- âœ¨ ê·€ê°€ ì²« í´ë¦­ íš¨ê³¼ìŒ -->
<audio id="goHomeFirstClickSfx" preload="auto">
  <source src="crying-411854 (1).mp3" type="audio/mpeg">
</audio>

<script>
  /* =======================
   ğŸ”Š íŒŒí‹° BGM: ì²« í´ë¦­/í‚¤ì…ë ¥ì— ìë™ ì‹œì‘
======================= */
const partyBgm  = document.getElementById("partyBgm");
const partyBgm2 = document.getElementById("partyBgm2");

let isPartyBgmPlaying = false;

// âœ… íŒŒí‹° BGM 2ê°œ ë™ì‹œì— ì¬ìƒ
function playBothPartyBgm() {
  if (partyBgm) {
    partyBgm.pause();
    partyBgm.currentTime = 0;
    partyBgm.play().catch(()=>{});
  }
  if (partyBgm2) {
    partyBgm2.pause();
    partyBgm2.currentTime = 0;
    partyBgm2.play().catch(()=>{});
  }
}

// âœ… íŒŒí‹° BGM 2ê°œ ë™ì‹œì— ì •ì§€
function stopBothPartyBgm() {
  [partyBgm, partyBgm2].forEach(a => {
    if (!a) return;
    a.pause();
    a.currentTime = 0;
  });
}

// âœ… ì²« ìƒí˜¸ì‘ìš©ì—ì„œ í•œ ë²ˆë§Œ ìë™ ì‹œì‘
function tryAutoPlayPartyBgm() {
  if (isPartyBgmPlaying) return;

  playBothPartyBgm();
  isPartyBgmPlaying = true;

  document.removeEventListener("pointerdown", tryAutoPlayPartyBgm);
  document.removeEventListener("keydown", tryAutoPlayPartyBgm);
  document.removeEventListener("touchstart", tryAutoPlayPartyBgm);
}

// âœ… í™”ë©´ ì–´ë””ë“  "ì²˜ìŒ" ìƒí˜¸ì‘ìš© ì‹œ BGM ì¬ìƒ
document.addEventListener("pointerdown", tryAutoPlayPartyBgm, { once: true });
document.addEventListener("keydown", tryAutoPlayPartyBgm, { once: true });
document.addEventListener("touchstart", tryAutoPlayPartyBgm, { once: true });

const transitionScreen = document.getElementById("transitionScreen");
const partyScreen = document.getElementById("partyScreen");
const introBinImg = document.getElementById("introBinImg");
const playerName = localStorage.getItem("playerName") || "í”Œë ˆì´ì–´";

/* ì „í™˜ ì¢…ë£Œ â†’ íŒŒí‹°ì¥ ë“±ì¥ */
setTimeout(()=>{
  transitionScreen.style.display="none";
  partyScreen.style.display="block";
  startIntro();
},1500);

/* =======================
   ğŸ‘£ ì´ë™ íš¨ê³¼ìŒ
======================= */
const walkSfx = document.getElementById("walkSfx");

// ì—°íƒ€/í‚¤ë³´ë“œ ë°˜ë³µ ì…ë ¥ë•Œ ë„ˆë¬´ ì‹œë„ëŸ½ì§€ ì•Šê²Œ ì¿¨íƒ€ì„
let lastWalkSfxTime = 0;
const WALK_SFX_COOLDOWN = 120; // ms

function playWalkSfx() {
  if (!walkSfx) return;

  const now = performance.now();
  if (now - lastWalkSfxTime < WALK_SFX_COOLDOWN) return;
  lastWalkSfxTime = now;

  walkSfx.pause();
  walkSfx.currentTime = 0;
  walkSfx.play().catch(()=>{});
}

/* ======================= */
/* ì›ë¹ˆ ì²« ëŒ€í™” (ë£° ì„¤ëª…) */
/* ======================= */
const dialogueBox=document.getElementById("dialogueBox");
const dialogueName=document.getElementById("dialogueName");
const dialogueText=document.getElementById("dialogueText");

let introIndex=0;
const introLines=[
  {name:"ì›ë¹ˆ",text:`${playerName}, íŒŒí‹°ì— ì˜¨ ê±¸ í™˜ì˜í•´.`},
  {name:"ì›ë¹ˆ",text:"ì—¬ê¸° ì¹œêµ¬ë“¤ì´ ìˆì–´. ê°€ì„œ ëŒ€í™”ë¥¼ í•´ë´."},
  {name:"ì›ë¹ˆ",text:"ëª¨ë“  ì‚¬ëŒê³¼ ëŒ€í™”í•œ í›„ ë‹¤ì‹œ ë‚˜ì—ê²Œ ì™€."}
];

function startIntro(){
  introBinImg.style.display = "block";
  dialogueBox.style.display="flex";
  showIntroLine();
}

function showIntroLine(){
  dialogueName.textContent=introLines[introIndex].name;
  dialogueText.textContent=introLines[introIndex].text;
}

dialogueBox.onclick=()=>{
  introIndex++;
  if(introIndex>=introLines.length){
    introBinImg.style.display="none";
    dialogueBox.style.display="none";
    enableMovement();
    return;
  }
  showIntroLine();
};

/* ======================= */
/* ì´ë™ ê¸°ëŠ¥ (â˜… ìˆ˜ì • ì™„ë£Œ) */
/* ======================= */
const player=document.getElementById("playerChar");

/* â˜… CSSì—ì„œ ì„¤ì •í•œ px ê°’ì„ ì •í™•íˆ ì½ì–´ì˜¤ê¸° */
let px = parseInt(window.getComputedStyle(player).left);
let py = parseInt(window.getComputedStyle(player).bottom);

/* ì´ë™ í™œì„±í™” */
function enableMovement(){
  document.addEventListener("keydown", movePlayer);
}

/* ì´ë™ í•¨ìˆ˜ */
function movePlayer(e){
  const step = 30;

  // ëŒ€í™” ì¤‘ ì´ë™ ë§‰ê¸°
  if (isDialogueOpen) return;

  let moved = false;

  if(e.key==="ArrowLeft")  { px -= step; moved = true; }
  if(e.key==="ArrowRight") { px += step; moved = true; }
  if(e.key==="ArrowUp")    { py += step; moved = true; }
  if(e.key==="ArrowDown")  { py -= step; moved = true; }

  if (!moved) return;

  player.style.left = px + "px";
  player.style.bottom = py + "px";

  playWalkSfx();
  checkNPC();
}

/* ======================= */
/* NPC ëŒ€í™” ë°ì´í„° (ì„ íƒì§€ ì¶”ê°€) */
/* ======================= */
const npcDialogues = {
  
  npc1: [
    { name: "ì—¬ìì•„ì´1", text: "ì•ˆë…• ë°˜ê°€ì›Œ ì²˜ìŒ ë³´ëŠ” ì–¼êµ´ì´ë„¤", img: "ki0a8e92.png" },
    { name: "ì—¬ìì•„ì´1", text: "ê·¼ë° ë„ˆ ì˜¤ëŠ˜ ê·¸ë ‡ê²Œ ì…ê³  ì˜¨ ê±°ì•¼?", img: "ki0a8e92.png" },
    { type: "choice",
      choices: [
        { image: "choice1.png",
          response: "ë„ˆ ëª¸ì„ ì´ ì´ìƒí•˜ê²Œ ë³´ì—¬. ì˜· í• ë•Œë¬¸ì´ ì•„ë‹ˆë¼ ê·¸ëƒ¥â€¦ ì›ë˜ ê·¸ëŸ° ì²´í˜•?" 
        },
        { 
          image: "choice2.png",
          response: "ê±°ìš¸ ë³´ê³  ë‚˜ì˜¨ ê±° ë§ì§€? ìš°ë¦¬ ì‚¬ì§„ì€ ì ˆëŒ€ ê°™ì´ ì°ì§€ ë§ì." 
        }
      ],
      img: "ki0a8e92.png"
    },
    { name: "ì—¬ìì•„ì´1", text: "ê·¸ë˜... ì—¬íŠ¼ ë°˜ê°€ì› ì–´", img: "ki0a8e92.png" }
  ],
  
  npc2: [
    { name: "ì—¬ìì•„ì´2", text: "ë„ˆ íŒŒí‹° ì²˜ìŒ ì˜¤ëŠ”êµ¬ë‚˜?", img: "ki.png" },
    { name: "ì—¬ìì•„ì´2", text: "ìŒâ€¦ ë‚˜ ê°™ìœ¼ë©´ ìœ„ë‘ ì•„ë˜ëŠ” ë°”ê¿¨ì„ ê²ƒ ê°™ì•„.", img: "ki.png" },
    { 
      type: "choice",
      choices: [
        { image: "choice3.png",
          response: "ì–¼êµ´ì´ ë„ˆë¬´ íë¦¿í•´ì„œ ëˆ„êµ°ì§€ë„ ëª°ëì–´. ì§€ë‚˜ê°€ëŠ” ë°°ê²½ì¸ ì¤„."},
        {  image: "choice4.png",
          response: "ë‚œ ë„ ìœ„í•´ ì§„ì‹¬ìœ¼ë¡œ í•˜ëŠ” ì¶©ê³ ì˜€ëŠ”ë°, ì™œ í™”ë¥¼ ë‚´ê³  ê·¸ë˜" }
      ],
      img: "ki.png"},
    { name: "ì—¬ìì•„ì´2", text: "ë„ ìœ„í•´ í•˜ëŠ” ë§ì´ì•¼... ë‹¤ìŒë¶€í„°ëŠ” í™”ì¥ì´ë¼ë„ ê·€ì—½ê²Œ í•˜ê³  ì™€", img: "ki.png" }
  ],
  
  npc3: [
    { name: "ë‚¨ìì•„ì´", text: "ìŒâ€¦ ë„ˆ ì²˜ìŒ ë³´ëŠ” ì–¼êµ´ì¸ë°?", img: "71e-6b.png" },
    // ğŸ”¹ ì„ íƒì§€ ì¶”ê°€
    { 
      type: "choice",
      choices: [
        { 
          image: "choice5.png",
          response: "í”¼ë¶€ ì™œ ê·¸ë˜? ì¡°ëª… ë•Œë¬¸ì´ ì•„ë‹ˆê³  ê·¸ëƒ¥ ìƒíƒœê°€ ì•ˆ ì¢‹ì•„ ë³´ì—¬." 
        },
        {  
          image: "choice6.png",
          response: "ì§„ì§œ ëª¨ë¥´ê² ì–´ì„œ ë¬»ëŠ” ê±´ë°â€¦ ì˜¤ëŠ˜ ê¾¸ë¯¼ ê±° ë§ì•„? ì†”ì§íˆ êµ¬ë³„ì´ ì•ˆ ë¼." 
        }
      ],
      img: "71e-6b.png"
    },
    { name: "ë‚¨ìì•„ì´", text: "ê·¸ ì´ŒìŠ¤ëŸ¬ìš´ ì˜·ì°¨ë¦¼ìœ¼ë¡œëŠ” ë‚˜ë‘ ë¶™ì–´ë‹¤ë‹ ìƒê°í•˜ì§€ ì•ŠëŠ” ê²Œ ì¢‹ì„ ê±°ì•¼ ", img: "71e-6b.png" }
  ],
  npcBin: [
    { name: "ì›ë¹ˆ", text: "ë¯¸ì•ˆí•œë° ë„ˆë‘ ë” ì´ìƒ ëª»ìˆê² ë‹¤.", img: "Group 2085666447.png" },
    { name: "ì›ë¹ˆ", text: "ê·¸ ì´ŒìŠ¤ëŸ¬ìš´ ì˜·ìŠ¤íƒ€ì¼ì´ë‘, ë„ˆí¬ ì—„ë§ˆê°€ í•´ì¤€ ê²ƒ ê°™ì€ í™”ì¥ ë”ì´ìƒ ëª» ë´ì£¼ê² ì–´", img: "Group Group 2085666447.png" }
  ]
};

/* ======================= */
/* ğŸ”¹ ì„ íƒì§€ í‘œì‹œ í•¨ìˆ˜ (ìˆ˜ì •) */
/* ======================= */
function showChoices(choiceData) {
  const existingChoices = document.getElementById("choicesContainer");
  if (existingChoices) existingChoices.remove();

  const choicesContainer = document.createElement("div");
  choicesContainer.id = "choicesContainer";
  choicesContainer.style.cssText = `
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    gap: 20px;
    z-index: 25;
    align-items: center;
    justify-content: center;
  `;

  choiceData.choices.forEach((choice) => {
    const btnWrapper = document.createElement("div");
    btnWrapper.style.cssText = `
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    `;

    const img = document.createElement("img");
    img.src = choice.image;
    img.style.cssText = `
      width: 600px;
      height: auto;
      display: block;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    `;

    btnWrapper.appendChild(img);

    btnWrapper.onmouseover = () => {
      img.style.transform = "scale(1.1)";
      img.style.boxShadow = "0 6px 20px rgba(255, 0, 187, 0.4)";
    };

    btnWrapper.onmouseout = () => {
      img.style.transform = "scale(1)";
      img.style.boxShadow = "0 4px 15px rgba(0,0,0,0.2)";
    };

    btnWrapper.onclick = () => {
      // ğŸ”¹ ì„ íƒì§€ ë‹¤ìŒ ë¼ì¸ì„ ì°¾ê¸°
      let nextLineIndex = lineIndex + 1;
      let nextLine = currentLines[nextLineIndex];
      
      // NPC ì‘ë‹µ í‘œì‹œ
      dialogueName.textContent = nextLine ? nextLine.name : "???";  // â† NPC ì´ë¦„ í‘œì‹œ
      dialogueText.textContent = choice.response;                    // â† NPC ëŒ€ì‚¬
      dialogueBox.style.display = "flex";
      choicesContainer.remove();

      lineIndex = nextLineIndex - 1;

      dialogueBox.onclick = continueDialogue;
    };

    choicesContainer.appendChild(btnWrapper);
  });

  document.getElementById("partyScreen").appendChild(choicesContainer);
}

/* ======================= */
/* NPC ëŒ€í™” ì‹œì‘ (ìˆ˜ì •) */
/* ======================= */
let currentLines = [];
let lineIndex = 0;
let isDialogueOpen = false;
let currentNpcId = null;

function startNPCDialogue(npcId) {
  if (isDialogueOpen) return;
  
  isDialogueOpen = true;
  currentNpcId = npcId;
  currentLines = npcDialogues[npcId] || [];
  lineIndex = 0;

  if (currentLines.length === 0) return;

  dialogueBox.style.display = "flex";
  const dialogueCharImg = document.getElementById("dialogueCharImg");
  dialogueCharImg.style.display = "block";

  showNextLine();
}
/* ======================= */
/* ğŸ”¹ NPCë³„ ì´ë¯¸ì§€ ì„¤ì • (í¬ê¸°, ìœ„ì¹˜) */
/* ======================= */
const npcImageSettings = {
  npc1: {
    width: "380px",      // ì—¬ìì•„ì´1 - ì´ë¯¸ì§€ ë„ˆë¹„
    right: "640px",       // ì—¬ìì•„ì´1 - ì˜¤ë¥¸ìª½ ê±°ë¦¬
    bottom: "0px"      // ì—¬ìì•„ì´1 - ì•„ë˜ ê±°ë¦¬
  },
  npc2: {
    width: "600px",      // ì—¬ìì•„ì´2 - ì´ë¯¸ì§€ ë„ˆë¹„
    right: "0px",      // ì—¬ìì•„ì´2 - ì˜¤ë¥¸ìª½ ê±°ë¦¬
    bottom: "0px"      // ì—¬ìì•„ì´2 - ì•„ë˜ ê±°ë¦¬
  },
  npc3: {
    width: "420px",      // ë‚¨ìì•„ì´ - ì´ë¯¸ì§€ ë„ˆë¹„
    right: "1070px",       // ë‚¨ìì•„ì´ - ì˜¤ë¥¸ìª½ ê±°ë¦¬
    bottom: "-570px"      // ë‚¨ìì•„ì´ - ì•„ë˜ ê±°ë¦¬
  },
  npcBin: {
    width: "350px",      // ì›ë¹ˆ - ì´ë¯¸ì§€ ë„ˆë¹„
    right: "50px",       // ì›ë¹ˆ - ì˜¤ë¥¸ìª½ ê±°ë¦¬
    bottom: "0px"      // ì›ë¹ˆ - ì•„ë˜ ê±°ë¦¬
  }
};

/* ======================= */
/* showNextLine() í•¨ìˆ˜ ìˆ˜ì • */
/* ======================= */
function showNextLine() {
  const currentLine = currentLines[lineIndex];

  // ì„ íƒì§€ íƒ€ì…ì¸ ê²½ìš°
  if (currentLine.type === "choice") {
    const dialogueCharImg = document.getElementById("dialogueCharImg");
    dialogueCharImg.src = currentLine.img;
    
    // ğŸ”¹ ì„ íƒì§€ ì‹œ NPC ì„¤ì • ì ìš©
    const settings = npcImageSettings[currentNpcId];
    if (settings) {
      dialogueCharImg.style.width = settings.width;
      dialogueCharImg.style.right = settings.right;
      dialogueCharImg.style.bottom = settings.bottom;
    }
    
    dialogueBox.style.display = "none";
    showChoices(currentLine);
    return;
  }

  // ì¼ë°˜ ëŒ€ì‚¬
  dialogueName.textContent = currentLine.name;
  dialogueText.textContent = currentLine.text;

  const dialogueCharImg = document.getElementById("dialogueCharImg");
  dialogueCharImg.src = currentLine.img;
  
  // ğŸ”¹ ì´ë¯¸ì§€ ì„¤ì • ì ìš© (currentNpcId ì‚¬ìš©)
  const settings = npcImageSettings[currentNpcId];
  if (settings) {
    dialogueCharImg.style.width = settings.width;
    dialogueCharImg.style.right = settings.right;
    dialogueCharImg.style.bottom = settings.bottom;
  }

  dialogueBox.onclick = continueDialogue;
}

// ğŸ”¹ ìƒˆë¡œìš´ í•¨ìˆ˜ ì¶”ê°€
function continueDialogue() {
  lineIndex++;

  if (lineIndex >= currentLines.length) {
    dialogueBox.style.display = "none";
    document.getElementById("dialogueCharImg").style.display = "none";
    dialogueBox.onclick = null;
    isDialogueOpen = false;
    currentNpcId = null;
    checkAllTalked();
    return;
  }

  showNextLine();
}

/* ======================= */
/* NPC ë¦¬ìŠ¤íŠ¸ (ì›ë¹ˆ ì œì™¸)    */
/* ======================= */
const npcs = [
  { id: "npc1", name: "ì—¬ìì•„ì´1" },
  { id: "npc2", name: "ì—¬ìì•„ì´2" },
  { id: "npc3", name: "ë‚¨ìì•„ì´" }
];

/* ======================= */
/* ëŒ€í™” ìƒíƒœ ì¶”ì             */
/* ======================= */
const talked = {
  npc1: false,
  npc2: false,
  npc3: false,
  npcBin: false
};

/* ======================= */
/* NPC ì ‘ì´‰ ê°ì§€             */
/* ======================= */
const interactionDistance = -20;

function checkNPC() {
  npcs.forEach(n => {
    const npcEl = document.getElementById(n.id);
    if (!npcEl) return;

    const npcRect = npcEl.getBoundingClientRect();
    const pRect = player.getBoundingClientRect();

    const near = !(
      pRect.right < npcRect.left - interactionDistance ||
      pRect.left > npcRect.right + interactionDistance ||
      pRect.bottom < npcRect.top - interactionDistance ||
      pRect.top > npcRect.bottom + interactionDistance
    );

    if (near && !talked[n.id]) {
      talked[n.id] = true;
      startNPCDialogue(n.id);
      checkAllTalked();
    }
  });

  // ğŸ”¹ ì›ë¹ˆì€ ë”°ë¡œ ì²˜ë¦¬
  if (talked.npc1 && talked.npc2 && talked.npc3 && !talked.npcBin) {
    const npcBinEl = document.getElementById("npcBin");
    if (!npcBinEl) return;

    const npcBinRect = npcBinEl.getBoundingClientRect();
    const pRect = player.getBoundingClientRect();

    const near = !(
      pRect.right < npcBinRect.left - interactionDistance ||
      pRect.left > npcBinRect.right + interactionDistance ||
      pRect.bottom < npcBinRect.top - interactionDistance ||
      pRect.top > npcBinRect.bottom + interactionDistance
    );

    if (near && !talked.npcBin) {
      talked.npcBin = true;
      startNPCDialogue("npcBin");
      checkAllTalked();
    }
  }
}

/* ======================= */
/* ëª¨ë‘ ëŒ€í™” ì™„ë£Œ í™•ì¸        */
/* ======================= */
function checkAllTalked() {
  if (talked.npc1 && talked.npc2 && talked.npc3 && talked.npcBin) {
    finalCutscene();
  }
}

/* ======================= */
/* ë§ˆì§€ë§‰ ì»·ì‹  (ìˆ˜ì •)         */
/* ======================= */
function finalCutscene() {
  setTimeout(() => {
    // ğŸ”¹ ì›ë¹ˆì˜ ë§ˆì§€ë§‰ ëŒ€ì‚¬ë“¤
    const binFinalLines = [
      `ë¯¸ì•ˆí•œë°, ${playerName}. íŒŒí‹°ëŠ” ë‹¤ ì¦ê²¼ì–´?`,
      "ê·¸ ì´ŒìŠ¤ëŸ¬ìš´ ì˜·ìŠ¤íƒ€ì¼ì´ë‘, ë„ˆí¬ ì—„ë§ˆê°€ í•´ì¤€ ê²ƒ ê°™ì€ í™”ì¥ ë”ì´ìƒ ëª» ë´ì£¼ê² ì–´",
      "ì´ì œ ì§‘ìœ¼ë¡œ ê°€ì£¼ë©´ ì¢‹ê² ì–´"
    ];

    let finalLineIndex = 0;

    dialogueBox.style.display = "flex";
    const dialogueCharImg = document.getElementById("dialogueCharImg");
    dialogueCharImg.src = "Group 2085666447.png";
    dialogueCharImg.style.display = "block";

    // ì²« ë²ˆì§¸ ëŒ€ì‚¬ í‘œì‹œ
    dialogueName.textContent = "ì›ë¹ˆ";
    dialogueText.textContent = binFinalLines[finalLineIndex];

    // í´ë¦­í•˜ë©´ ë‹¤ìŒ ëŒ€ì‚¬ë¡œ ì§„í–‰
    dialogueBox.onclick = () => {
      finalLineIndex++;

      if (finalLineIndex >= binFinalLines.length) {
        // ğŸ”¹ ë§ˆì§€ë§‰ ëŒ€ì‚¬ í›„ ì¢…ë£Œ
        dialogueBox.style.display = "none";
        dialogueCharImg.style.display = "none";
        dialogueBox.onclick = null;

        startGoHomeCutscene();
        return;
      }

      // ë‹¤ìŒ ëŒ€ì‚¬ í‘œì‹œ
      dialogueText.textContent = binFinalLines[finalLineIndex];
    };
  }, 500);
}

/* ======================= */
/* âœ… ê·€ê°€ ì»·ì‹  DOM */
const goHomeScreen   = document.getElementById("goHomeScreen");
const goHomePlayer   = document.getElementById("goHomePlayer");
const goHomeDialogue = document.getElementById("goHomeDialogue");
const goHomeName     = document.getElementById("goHomeName");
const goHomeText     = document.getElementById("goHomeText");

const goHomeBgm = document.getElementById("goHomeBgm");
const goHomeFirstClickSfx = document.getElementById("goHomeFirstClickSfx");

/* âœ… ê·€ê°€ BGM */
function playGoHomeBgm(){
  if (!goHomeBgm) return;
  goHomeBgm.pause();
  goHomeBgm.currentTime = 0;
  goHomeBgm.play().catch(()=>{});
}

/* âœ… ê·€ê°€ ëŒ€í™”ì°½ í´ë¦­ íš¨ê³¼ìŒ */
function playGoHomeFirstClickSfx(){
  if (!goHomeFirstClickSfx) return;
  goHomeFirstClickSfx.pause();
  goHomeFirstClickSfx.currentTime = 0;
  goHomeFirstClickSfx.play().catch(()=>{});
}

/* ======================= */
/* âœ… í˜¼ì£ë§ ë¼ì¸ */
const goHomeLines = [
  { name: playerName, text: "ì§‘ì— ê°€ì„œ ë‹¤ì‹œ ì˜·ì„ ê°ˆì•„ì…ì." },
  { name: playerName, text: "ë‹¤ì‹œ íŒŒí‹°ì— ê°€ì•¼ê² ì–´." },
  { name: playerName, text: "ì˜ˆìœ ì˜·ìœ¼ë¡œ ë‹¤ì‹œ ê°ˆì•„ì…ìœ¼ë©´ ì¹œêµ¬ë“¤ì´ ë‚  ì¢‹ì•„í• ì§€ë„ ëª°ë¼." }
];

let goHomeIdx = 0;

function showGoHomeLine(){
  goHomeName.textContent = goHomeLines[goHomeIdx].name;
  goHomeText.textContent = goHomeLines[goHomeIdx].text;
}

/* ======================= */
/* âœ… ê·€ê°€ ì»·ì‹  ì‹œì‘ */
function startGoHomeCutscene(){
  stopBothPartyBgm();

  // ê·€ê°€ í™”ë©´ ON
  goHomeScreen.style.display = "block";

  // ğŸ«¨ ìºë¦­í„° ë–¨ë¦¼ ì‹œì‘
  if (goHomePlayer) goHomePlayer.classList.add("shiver");

  // ê·€ê°€ BGM ì‹œì‘
  playGoHomeBgm();

  // ëŒ€ì‚¬ ì´ˆê¸°í™”
  goHomeIdx = 0;
  goHomeDialogue.style.display = "flex";
  showGoHomeLine();

  // í´ë¦­ í•¸ë“¤ëŸ¬ ì„¸íŒ…
  goHomeDialogue.onclick = () => {
    // âœ… ì›í•˜ëŠ”ëŒ€ë¡œ "í´ë¦­í•  ë•Œë§ˆë‹¤" íš¨ê³¼ìŒ
    playGoHomeFirstClickSfx();

    goHomeIdx++;

    if (goHomeIdx >= goHomeLines.length) {
      goHomeDialogue.style.display = "none";

      // í•„ìš”í•˜ë©´ ë–¨ë¦¼/ë¸Œê¸ˆ ì •ë¦¬
      if (goHomePlayer) goHomePlayer.classList.remove("shiver");
      if (goHomeBgm) goHomeBgm.pause();

      location.href = "closet_dressup.html";
      return;
    }

    showGoHomeLine();
  };
}
</script>

</body>
</html>