<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë“œë ˆìŠ¤ì—… í™”ë©´ (ì¬ë„ì „ ì˜·ì¥)</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Single+Day&display=swap" rel="stylesheet">

<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    width:100vw;
    height:100vh;
    overflow:hidden;
    background:#fff;
    position:relative;
    user-select:none;
  }

  /* =======================
     ğŸ”Š BGM í† ê¸€
  ======================= */
  #bgmToggle {
    position: absolute;
    top: 2%;
    right: 2%;
    width: 100px;
    height: 100px;
    cursor: pointer;
    z-index: 1000;
  }
  #bgmToggle img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    pointer-events: none;
  }

  /* =======================
     ë¡œë”©
  ======================= */
  #loadingScreen {
    position:fixed;
    width:100%; height:100%;
    top:0; left:0;
    background:url('closet back.png') no-repeat center/cover;
    display:flex; justify-content:center; align-items:center;
    flex-direction:column; z-index:999;
  }
  #loadingBarWrap {
    width:30%;
    height:25px;
    background:rgba(255,255,255,0.6);
    border-radius:20px;
    overflow:hidden;
  }
  #loadingBar {
    width:0%;
    height:100%;
    background:#FF00BB;
    border-radius:20px;
    animation:fillBar 1.2s forwards ease-in-out;
  }
  @keyframes fillBar { 0%{width:0%} 100%{width:100%} }

  /* =======================
     ë“œë ˆìŠ¤ì—… í™”ë©´
  ======================= */
  #dressupScreen {
    display:none;
    position:relative;
    width:100%; height:100%;
  }

  #roomBg {
    position:absolute;
    width:100%; height:100%;
    top:0; left:0;
    object-fit:cover;
    z-index:1;
  }

  /* =======================
     ì˜·ì¥
  ======================= */
  #closetWrapper {
    position: relative;
    bottom:0%; left:66%;
    width:46%;
    transform:translateX(-50%);
    z-index:5;
    pointer-events:auto;
  }
  #closetImg {
    width:100%;
    display:block;
    pointer-events:none;
  }

  /* =======================
     âœ… ìºë¦­í„°+ì˜ìƒ ê³ ì • ì»¨í…Œì´ë„ˆ
  ======================= */
  #playerWrapper{
    position:absolute;
    left:22%;
    bottom:0%;
    width:201px;
    height:700px;
    transform:translateX(-50%);
    z-index:10;
    pointer-events:none;
  }

  #playerBase {
    position:absolute;
    left:50%;
    bottom:0%;
    width:100%;
    transform:translateX(-50%);
    z-index:10;
  }

  #wearWig, #wearDress, #wearTop, #wearBottom, #wearShoes, #wearAcc{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    pointer-events:none;
  }

  /* ---- ì°©ìš© ìœ„ì¹˜(ë„ˆê°€ ì´ë¯¸ ë§ì¶°ë‘” ê°’ ìœ ì§€) ---- */
  #wearWig    { top:-27%; height:335px; z-index:22; }
  #wearDress  { top:-4%;  height:450px; z-index:20; }
  #wearTop    { top:-4%;  height:270px; z-index:20; }
  #wearBottom { top:23%;  height:440px; z-index:19; }
  #wearShoes  { bottom:-2%; height:350px; z-index:18; }
  #wearAcc    { top:-6%;  height:110px; z-index:21; }

  /* =======================
     ê°€ë°œ ìŠ¬ë¡¯
  ======================= */
  #wigSlot {
    position:absolute;
    width:100%;
    height:180px;
    top:18.5%;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:50;
    pointer-events:auto;
  }

  .arrowBtn {
    width:40px; height:40px;
    background:transparent;
    border:none; cursor:pointer;
    color:#F70093;
    font-size:30px;
    z-index:200;
  }

  .wigListWrapper {
    width:560px; height:140px;
    overflow:hidden; position:relative;
    margin:0 10px;
  }

  .wigList {
    position:absolute;
    display:flex;
    gap:7px;
    left:0px;
    transition:0.3s ease;
    list-style:none;
  }

  .wigItem { width:130px; height:130px; position:relative; }
  .wigSlotBg { position:absolute; width:130px; height:130px; z-index:1; }
  .wigImg { width:120px; height:120px; position:absolute; top:5px; left:5px; cursor:pointer; z-index:5; }

  /* =======================
     ì›í”¼ìŠ¤Â·ìƒì˜Â·ì•…ì„¸ì‚¬ë¦¬
  ======================= */
  #dressSlot{
    position:absolute;
    left:15%;
    top:40%;
    width:40%;
    display:flex;
    z-index:60;
  }
  .dressImg { width:120px; margin-left:-80px; }

  #topSlot {
    position:absolute;
    left:28%;
    top:40%;
    width:40%;
    display:flex;
    z-index:60;
  }
  .topImg { width:120px; margin-left:-50px; }

  #accSlot {
    position:absolute;
    left:67%;
    top:45%;
    width:20%;
    display:flex;
    gap:10px;
    z-index:60;
  }
  .accImg { width:120px; margin-left:-35px; }

  /* =======================
     í•˜ì˜Â·ì‹ ë°œ
  ======================= */
  #bottomSlot {
    position:absolute;
    left:15%;
    top:60%;
    width:30%;
    display:flex;
    z-index:59;
  }
  .bottomImg { width:110px; margin-left:-10px; }

  #shoesSlot {
    position:absolute;
    left:68%;
    top:58%;
    width:10%;
    display:flex;
    z-index:60;
  }
  .shoesImg {
    width:40px;
    max-width:100px;
    margin-left:-50px;
  }

  .dressImg, .topImg, .bottomImg, .shoesImg, .accImg {
    width:120px;
    cursor:pointer;
  }

  /* =======================
     ì»¨íŠ¸ë¡¤ ë²„íŠ¼
  ======================= */
  #controlButtons {
    position:absolute;
    top:100px;
    left:-50px;
    width:100%;
    padding:8px 12px;
    display:flex;
    justify-content:flex-end;
    gap:8px;
    z-index:70;
    pointer-events:none;
  }
  .controlBtn {
    width:45px;
    height:45px;
    cursor:pointer;
    pointer-events:auto;
  }

  /* =======================
     ğŸ”¹ ì™¸ì¶œí•˜ê¸° ë²„íŠ¼
  ======================= */
  #goOutWrapper {
    position:absolute;
    left:90%;
    bottom:40px;
    transform:translateX(-50%);
    z-index:80;
    display:none;
  }

  #goOutButton {
    font-family: 'Single Day', cursive;
    width:220px;
    padding:10px 25px;
    background:#00DDFF;
    border:7px solid #C0F9F6;
    border-radius:999px;
    font-size:40px;
    font-weight:1000;
    color:#FF8BE0;
    cursor:pointer;
    box-shadow:0 4px 8px rgba(0,0,0,0.15);
    text-shadow:
      -2px  0   0 #ffffff,
       2px  0   0 #ffffff,
       0    2px 0 #ffffff,
       0   -2px 0 #ffffff,
      -2px -2px 0 #ffffff,
       2px -2px 0 #ffffff,
      -2px  2px 0 #ffffff,
       2px  2px 0 #ffffff;
  }

  /* ë¹ˆ src ìˆ¨ê¹€ */
  #wearDress[src=""],
  #wearTop[src=""],
  #wearBottom[src=""],
  #wearShoes[src=""],
  #wearAcc[src=""],
  #wearWig[src=""] {
    display:none !important;
  }

  /* âœ… ê°€ë°œ ì• ë²Œë ˆ(íŠ¸ë¼ìš°ë§ˆ) ì—°ì¶œ ë ˆì´ì–´ */
  #wigCaterpillarFx{
    position:absolute;
    inset:0;
    z-index:999;          /* wearWigë³´ë‹¤ ìœ„ */
    pointer-events:none;
  }

  /* ê°€ë°œ í•œ ë§ˆë””(?) */
  #wigCaterpillarFx .wigSeg{
    position:absolute;
    left:50%;
    transform:translateX(-50%);
    width:180px;          /* í•„ìš”í•˜ë©´ ì¡°ì ˆ */
    opacity:1;
    animation: wigSegFlash 0.55s steps(1, end) forwards;
  }

  /* ì‚´ì§ íŠ€ì—ˆë‹¤ê°€ ì‚¬ë¼ì§€ëŠ” ëŠë‚Œ */
  @keyframes wigSegPop{
    0%   { opacity:1; }
    20%  { opacity:1; }
    100% { opacity:0; }
  }

  /* =======================
   âœ… BGM ìŠ¬ë¡œìš° ì‹œ í™”ë©´ íš¨ê³¼
======================= */

/* âœ… ë‹¨ìˆœ ì˜¤ë²„ë ˆì´ ê¸°ë³¸ ìƒíƒœ */
#bgmGlitchOverlay{
  position: fixed;
  inset: 0;
  z-index: 900;
  pointer-events: none;
  opacity: 0;

  /* âœ… ì—¬ê¸°ë§Œ ì›í•˜ëŠ” ìƒ‰ìœ¼ë¡œ */
  background: rgba(80, 0, 23, 1);

  /* âœ… ê¸€ë¦¬ì¹˜ ëŠë‚Œ ìš”ì†Œ ì œê±° */
  mix-blend-mode: color-burn;
  filter: none;
  animation: none;
}

/* âœ… ìŠ¬ë¡œìš° ìƒíƒœì¼ ë•Œë§Œ ì˜¤ë²„ë ˆì´ ON */
body.bgm-slow #bgmGlitchOverlay{
  opacity: 1;
  transition: opacity 0.12s ease;
}

/* ìŠ¬ë¡œìš° ìƒíƒœì—ì„œë§Œ ì˜¤ë²„ë ˆì´ ON */
body.bgm-slow #bgmGlitchOverlay{
  opacity:0.9;
  animation: glitchPulse 0.18s steps(1,end) infinite;
}

/* =======================
   âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ ì˜¤ë²„ë ˆì´ (ì´ë¯¸ì§€)
  ======================= */
  #dressTraumaOverlay{
    position:fixed;
    inset:0;
    z-index:950;
    pointer-events:auto;
  }

  @keyframes traumaFlash{
  0% { filter: contrast(1) brightness(1); }
  10%{ filter: contrast(1.4) brightness(1.15); }
  20%{ filter: contrast(1) brightness(1); }
  30%{ filter: contrast(1.3) brightness(1.1); }
  100%{ filter: contrast(1) brightness(1); }
}

#dressTraumaOverlay{
  animation: traumaFlash 0.25s steps(1,end) 1;
}

  #dressTraumaImg{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    z-index:1;
  }

  /* ëŒ€í™”ì°½ì€ ì´ë¯¸ì§€ ìœ„ë¡œ */
  #dressTraumaDialogue{
    z-index:5;
  }


  /* âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ ëŒ€í™”ì°½ UI */
.dialogueBox{
  position: absolute;
  left: 50%;
  bottom: 24px;
  transform: translateX(-50%);
  width: 95%;
  max-width: 1400px;
  min-height: 200px;
  padding: 25px 30px;
  background: linear-gradient(90deg,#6B0B61,#360331);
  border-radius: 20px;
  outline:3px dotted #FEE5FF;outline-offset:-5px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  font-family: 'Single Day', cursive;
  cursor: pointer;
  z-index: 5; /* ì´ë¯¸ì§€ ìœ„ */
}

#dressTraumaName{
  font-size: 30px;
  font-weight:bold;
  color: #E300EE;
   text-shadow:-3px 0 #FFFFFF,3px 0 #FFFFFF,0 -3px #FFFFFF,0 3px #FFFFFF,
                -3px -3px #FFFFFF,-3px 3px #FFFFFF,3px -3px #FFFFFF,3px 3px #FFFFFF;
  margin-bottom:8px;white-space:nowrap;
}

#dressTraumaText{
  font-size: 26px;
  color: #FFFFFF;
  line-height: 1.5;
  white-space:normal;word-break:keep-all;
}

</style>
</head>

<body>

<!-- ğŸ”Š BGM ì˜¤ë””ì˜¤ -->
<audio id="bgm" loop>
  <source src="No Copyright Music NCS).mp3" type="audio/mpeg">
</audio>

<!-- ğŸ”Š BGM í† ê¸€ ë²„íŠ¼ -->
<div id="bgmToggle">
  <img id="bgmIcon" src="Group 2085666441.png">
</div>

<!-- ë¡œë”© -->
<div id="loadingScreen">
  <img id="loadingText" src="Loading....png">
  <div id="loadingBarWrap"><div id="loadingBar"></div></div>
</div>

<!-- ë©”ì¸ -->
<div id="dressupScreen">

  <img id="roomBg" src="Frame 2087327024.png">

  <div id="closetWrapper">
    <img id="closetImg" src="Group 2085666421.png">

    <!-- ì»¨íŠ¸ë¡¤ -->
    <div id="controlButtons">
      <img id="undoBtn"  class="controlBtn" src="Group 2085666422.png"  alt="undo">
      <img id="resetBtn" class="controlBtn" src="Group 2085666424.png" alt="reset">
    </div>

    <!-- ê°€ë°œ ìŠ¬ë¡¯ -->
    <div id="wigSlot">
      <button id="leftArrow" class="arrowBtn">â—€</button>

      <div class="wigListWrapper">
        <ul class="wigList" id="wigList">
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="basic hair.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="gold ponytail.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="pink hair 2.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="hairbun.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="long hair.png"></li>
          <li class="wigItem"><img class="wigSlotBg" src="Group2085666388.png"><img class="wigImg" src="red hair.png"></li>
        </ul>
      </div>

      <button id="rightArrow" class="arrowBtn">â–¶</button>
    </div>

    <!-- ì›í”¼ìŠ¤ -->
    <div id="dressSlot">
      <img class="dressImg" src="dress1.png">
      <img class="dressImg" src="dress2.png">
    </div>

    <!-- ìƒì˜ -->
    <div id="topSlot">
      <img class="topImg" src="top1.png">
      <img class="topImg" src="top2.png">
      <img class="topImg" src="top3.png">
      <img class="topImg" src="top4.png">
    </div>

    <!-- ì•…ì„¸ì„œë¦¬ -->
    <div id="accSlot">
      <img class="accImg" src="acc1.png">
      <img class="accImg" src="acc2.png">
      <img class="accImg" src="acc3.png">
      <img class="accImg" src="acc4.png">
    </div>

    <!-- í•˜ì˜ -->
    <div id="bottomSlot">
      <img class="bottomImg" src="bottom1.png">
      <img class="bottomImg" src="bottom2.png">
      <img class="bottomImg" src="bottom3.png">
    </div>

    <!-- ì‹ ë°œ -->
    <div id="shoesSlot">
      <img class="shoesImg" src="shoes1.png">
      <img class="shoesImg" src="shoes2.png">
      <img class="shoesImg" src="shoes3.png">
      <img class="shoesImg" src="shoes4.png">
    </div>
  </div>

  <!-- âœ… ìºë¦­í„°+ì°©ìš© ë ˆì´ì–´ -->
  <div id="playerWrapper">
    <img id="playerBase" src="Group 2085666411.png">
    <img id="wearDress">
    <img id="wearTop">
    <img id="wearBottom">
    <img id="wearShoes">
    <img id="wearAcc">
    <img id="wearWig">
  </div>

  <div id="bgmGlitchOverlay"></div>

  <!-- âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ ì˜¤ë²„ë ˆì´ (ì´ë¯¸ì§€ ë²„ì „) -->
<div id="dressTraumaOverlay" style="display:none;">
  <!-- âœ… í™”ë©´ì„ ë®ëŠ” íŠ¸ë¼ìš°ë§ˆ ì´ë¯¸ì§€ -->
  <img id="dressTraumaImg" src="Frame 2087327018.png" alt="">

  <!-- âœ… ì‹ ë°œ íŠ¸ë¼ìš°ë§ˆ ì˜¤ë²„ë ˆì´ -->
<div id="shoesTraumaOverlay" style="display:none;">
  <img id="shoesTraumaImg" src="Frame 2087327021.png" alt="">

  <div id="shoesTraumaDialogue" class="dialogueBox" style="display:flex;">
    <div id="shoesTraumaName"></div>
    <div id="shoesTraumaText"></div>
  </div>
</div>

<!-- âœ… ì‹ ë°œ íŠ¸ë¼ìš°ë§ˆ íš¨ê³¼ìŒ(ì›í•˜ë©´) -->
<audio id="shoesTraumaSfx" src="shoes-trauma-sfx.mp3" preload="auto"></audio>

  <!-- âœ… ì˜ìƒ ìœ„ ëŒ€í™”ì°½ ëŠë‚Œ ê·¸ëŒ€ë¡œ -->
  <div id="dressTraumaDialogue" class="dialogueBox" style="display:flex;">
    <div id="dressTraumaName"></div>
    <div id="dressTraumaText"></div>
  </div>
</div>

  <!-- ğŸ”¹ ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ -->
  <div id="goOutWrapper">
    <button id="goOutButton">ì™¸ì¶œí•˜ê¸°</button>
  </div>

  <audio id="clickSfx" src="shine-7-268909.mp3"></audio>
  <audio id="wigTraumaSfx" src="068304_no-signal-tv.mp3" preload="auto"></audio>
  <audio id="dressTraumaSfx" src="horror-background-music-443137 (1).mp3" preload="auto"></audio>
  <audio id="bgmSlowSfx" src="glitch-sfx-312910 (1).mp3" preload="auto"></audio>
</div>

<script>
  /* =======================
     SFX
  ======================= */
  const clickSfx = document.getElementById("clickSfx");
  const playerName = localStorage.getItem("playerName") || "í”Œë ˆì´ì–´";
  const wigTraumaSfx = document.getElementById("wigTraumaSfx");
  const dressTraumaSfx = document.getElementById("dressTraumaSfx");
  const bgmSlowSfx = document.getElementById("bgmSlowSfx");

  let firstWigTraumaPlayed = false;

  /* =======================
     ğŸ”Š BGM í† ê¸€
  ======================= */
  const bgmAudio = document.getElementById('bgm');
  const bgmToggle = document.getElementById('bgmToggle');
  const bgmIcon = document.getElementById('bgmIcon');
  let isBgmPlaying = false;
  

bgmToggle.addEventListener('click', () => {
  if (isBgmPlaying) {
    bgmAudio.pause();
    bgmIcon.src = "Group 2085666441.png";
    isBgmPlaying = false;

    // âœ… êº¼ì§ˆ ë•ŒëŠ” ìŠ¬ë¡œìš° ë£¨í”„ ì •ì§€
    stopRandomBgmSlowLoop();

  } else {
    bgmAudio.play().catch(()=>{});
    bgmIcon.src = "Group 2085666442.png";
    isBgmPlaying = true;

    // âœ… ì¼œì§ˆ ë•Œë§Œ ìŠ¬ë¡œìš° ë£¨í”„ ì‹œì‘
    startRandomBgmSlowLoop();
  }
});

  /* âœ… ì²« ìƒí˜¸ì‘ìš©ì—ì„œ ìë™ BGM ì‹œì‘ */
  function tryAutoPlayBgm() {
    if (isBgmPlaying) return;

    bgmAudio.play().then(() => {
      isBgmPlaying = true;
      bgmIcon.src = "Group 2085666442.png";

      startRandomBgmSlowLoop();
    }).catch(()=>{});

    // once ì˜µì…˜ì´ë¼ ì‚¬ì‹¤ìƒ í•„ìš” ì—†ì§€ë§Œ ì•ˆì „í•˜ê²Œ
    document.removeEventListener("pointerdown", tryAutoPlayBgm);
    document.removeEventListener("keydown", tryAutoPlayBgm);
    document.removeEventListener("touchstart", tryAutoPlayBgm);
  }

  document.addEventListener("pointerdown", tryAutoPlayBgm, { once: true });
  document.addEventListener("keydown", tryAutoPlayBgm, { once: true });
  document.addEventListener("touchstart", tryAutoPlayBgm, { once: true });

  /* =========================================
   âœ… ëœë¤ BGM ìŠ¬ë¡œìš° + ê¸€ë¦¬ì¹˜/í‘ë°± ì—°ì¶œ
   - BGMì´ ì¼œì ¸ ìˆì„ ë•Œë§Œ ì‘ë™
   - ëœë¤ ê°„ê²©ìœ¼ë¡œ 0.6~1.0ì´ˆ ì •ë„ ëŠë ¤ì¡Œë‹¤ê°€ ì›ë³µ
========================================= */

let bgmSlowTimer = null;
let bgmSlowActive = false;
let slowLoopSession = 0;
// âœ… SFX ê³¼ë‹¤ ì¬ìƒ ë°©ì§€ìš© ì¿¨ë‹¤ìš´
let lastSlowSfxAt = 0;
const SLOW_SFX_COOLDOWN = 1200; // ms

const SLOW_RATE = 0.3;           // ëŠë ¤ì§€ëŠ” ì •ë„(0.65~0.8 ì·¨í–¥)
const SLOW_MIN_MS = 5000;          // ìŠ¬ë¡œìš° ì§€ì† ìµœì†Œ
const SLOW_MAX_MS = 6500;         // ìŠ¬ë¡œìš° ì§€ì† ìµœëŒ€

const GAP_MIN_MS = 4500;          // ë‹¤ìŒ ìŠ¬ë¡œìš°ê¹Œì§€ ìµœì†Œ ê°„ê²©
const GAP_MAX_MS = 12000;         // ë‹¤ìŒ ìŠ¬ë¡œìš°ê¹Œì§€ ìµœëŒ€ ê°„ê²©

function rand(min, max){
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function applySlowVisual(on){
  // body ì „ì²´ì— ì ìš©
  document.body.classList.toggle("bgm-slow", on);

  // ë§Œì•½ "ì „ì²´ ë§ê³  ë“œë ˆìŠ¤ì—…ë§Œ" í•˜ê³  ì‹¶ìœ¼ë©´:
  // const ds = document.getElementById("dressupScreen");
  // if(ds) ds.classList.toggle("bgm-slow", on);
}

function startRandomBgmSlowLoop(){
  // âœ… ê¸°ì¡´ ë£¨í”„ ì™„ì „ ì¢…ë£Œ + ì„¸ì…˜ ê°±ì‹ 
  stopRandomBgmSlowLoop();

  // âœ… ì´ë²ˆ ì‹¤í–‰ë§Œ ìœ íš¨í•œ ì„¸ì…˜ id
  const mySession = slowLoopSession;

  const scheduleNext = () => {
    // âœ… ë‹¤ë¥¸ ì„¸ì…˜ì´ ì‹œì‘ëìœ¼ë©´ ì¦‰ì‹œ ì¢…ë£Œ
    if (mySession !== slowLoopSession) return;

    if (!isBgmPlaying) {
      bgmSlowTimer = setTimeout(scheduleNext, 800);
      return;
    }

    const gap = rand(GAP_MIN_MS, GAP_MAX_MS);

    bgmSlowTimer = setTimeout(() => {
      if (mySession !== slowLoopSession) return;
      if (!isBgmPlaying) { scheduleNext(); return; }

      // âœ… ìŠ¬ë¡œìš° ì‹œì‘
      bgmSlowActive = true;
      bgmAudio.playbackRate = SLOW_RATE;
      applySlowVisual(true);

      // âœ… ìŠ¬ë¡œìš° ì‹œì‘ ìˆœê°„ì—ë§Œ SFX 1ë²ˆ
      const now = Date.now();
      if (bgmSlowSfx && (now - lastSlowSfxAt) > SLOW_SFX_COOLDOWN) {
        lastSlowSfxAt = now;
        bgmSlowSfx.currentTime = 0;
        bgmSlowSfx.play().catch(()=>{});
      }

      const duration = rand(SLOW_MIN_MS, SLOW_MAX_MS);

      bgmSlowTimer = setTimeout(() => {
        if (mySession !== slowLoopSession) return;

        // âœ… ì›ë³µ
        bgmSlowActive = false;
        bgmAudio.playbackRate = 1.0;
        applySlowVisual(false);

        scheduleNext();
      }, duration);

    }, gap);
  };

  scheduleNext();
}

function stopRandomBgmSlowLoop(){
  // âœ… ì„¸ì…˜ì„ ì˜¬ë ¤ì„œ ì´ì „ ë£¨í”„ ì „ë¶€ ë¬´íš¨í™”
  slowLoopSession++;

  if (bgmSlowTimer) {
    clearTimeout(bgmSlowTimer);
    bgmSlowTimer = null;
  }

  bgmSlowActive = false;
  bgmAudio.playbackRate = 1.0;
  applySlowVisual(false);
}

  /* =======================
     ë¡œë”© â†’ ë©”ì¸ í‘œì‹œ
  ======================= */
  const loadingScreen  = document.getElementById("loadingScreen");
  const dressupScreen  = document.getElementById("dressupScreen");

  setTimeout(() => {
    loadingScreen.style.display  = "none";
    dressupScreen.style.display  = "block";
  }, 900);

  /* =======================
     ìºë¦­í„° & ì°©ìš© ë ˆì´ì–´
  ======================= */
  const playerBase  = document.getElementById("playerBase");
  const wearWig     = document.getElementById("wearWig");
  const wearDress   = document.getElementById("wearDress");
  const wearTop     = document.getElementById("wearTop");
  const wearBottom  = document.getElementById("wearBottom");
  const wearShoes   = document.getElementById("wearShoes");
  const wearAcc     = document.getElementById("wearAcc");

  /* =======================
     ì»¨íŠ¸ë¡¤ ë²„íŠ¼
  ======================= */
  const undoBtn  = document.getElementById("undoBtn");
  const resetBtn = document.getElementById("resetBtn");

  /* ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ */
  const goOutWrapper = document.getElementById("goOutWrapper");
  const goOutButton  = document.getElementById("goOutButton");

  /* =======================
     âœ… ê°€ë°œ ì¢Œ/ìš° ì´ë™
  ======================= */
  const leftArrow = document.getElementById("leftArrow");
  const rightArrow = document.getElementById("rightArrow");
  const wigList = document.getElementById("wigList");

  const STEP = 140;

  function clamp(val, min, max){ return Math.max(min, Math.min(max, val)); }

  function getLimits(){
    const wrapper = document.querySelector(".wigListWrapper");
    const listWidth = wigList.scrollWidth;
    const wrapWidth = wrapper.clientWidth;
    const minLeft = Math.min(0, wrapWidth - listWidth);
    const maxLeft = 0;
    return { minLeft, maxLeft };
  }

  leftArrow.addEventListener("click", () => {
    const currentLeft = parseInt(window.getComputedStyle(wigList).left) || 0;
    const { minLeft, maxLeft } = getLimits();
    wigList.style.left = clamp(currentLeft + STEP, minLeft, maxLeft) + "px";
  });

  rightArrow.addEventListener("click", () => {
    const currentLeft = parseInt(window.getComputedStyle(wigList).left) || 0;
    const { minLeft, maxLeft } = getLimits();
    wigList.style.left = clamp(currentLeft - STEP, minLeft, maxLeft) + "px";
  });

  /* =======================
     íˆìŠ¤í† ë¦¬
  ======================= */
  let historyStack = [];

  function getCurrentState() {
    return {
      wig:    wearWig.src   || "",
      dress:  wearDress.src || "",
      top:    wearTop.src   || "",
      bottom: wearBottom.src|| "",
      shoes:  wearShoes.src || "",
      acc:    wearAcc.src   || ""
    };
  }

  function applyState(state) {
    wearWig.src    = state.wig    || "";
    wearDress.src  = state.dress  || "";
    wearTop.src    = state.top    || "";
    wearBottom.src = state.bottom || "";
    wearShoes.src  = state.shoes  || "";
    wearAcc.src    = state.acc    || "";
  }

  function pushHistory() {
    historyStack.push(getCurrentState());
  }

  window.addEventListener("load", () => {
    pushHistory();
  });

  undoBtn.addEventListener("click", () => {
    if (historyStack.length <= 1) return;
    historyStack.pop();
    applyState(historyStack[historyStack.length - 1]);
  });

  resetBtn.addEventListener("click", () => {
    const emptyState = { wig:"", dress:"", top:"", bottom:"", shoes:"", acc:"" };
    applyState(emptyState);
    historyStack = [emptyState];

    // âœ… ë¦¬ì…‹í•˜ë©´ ì²« ê°€ë°œ íŠ¸ë¼ìš°ë§ˆë„ ë‹¤ì‹œ 1íšŒ ê°€ëŠ¥
    firstWigTraumaPlayed = false;
    firstDressTraumaPlayed = false;
  });

  /* =======================
     âœ… ê°€ë°œ ì• ë²Œë ˆ íŠ¸ë¼ìš°ë§ˆ ì—°ì¶œ(ì‹œê°ë§Œ)
     - ì‚¬ìš´ë“œëŠ” ì—¬ê¸°ì„œ ì¬ìƒí•˜ì§€ ì•ŠìŒ (ì¤‘ë³µ ë°©ì§€)
  ======================= */
  function triggerWigCaterpillar(wigSrc){
    const wrapper = document.getElementById("playerWrapper");
    if (!wrapper) return;

    const old = document.getElementById("wigCaterpillarFx");
    if (old) old.remove();

    const fx = document.createElement("div");
    fx.id = "wigCaterpillarFx";

    const segments = 7;
    const startTop = -18;
    const gap = 11;

    for(let i=0; i<segments; i++){
      const img = document.createElement("img");
      img.src = wigSrc;
      img.className = "wigSeg";
      img.style.top = `${startTop + i*gap}%`;
      fx.appendChild(img);
    }

    wrapper.appendChild(fx);

    setTimeout(()=> fx.remove(), 850);
  }

  /* =======================
     ë“œë˜ê·¸
  ======================= */
  let dragImg=null, dragSrc="", offsetX=0, offsetY=0;
  let activeSlotId=null, activeClearFunc=null;

  function setupDrag(selector, targetId, clearFunc){
    document.querySelectorAll(selector).forEach(img=>{
      img.addEventListener("mousedown", e=>{
        e.preventDefault();
        dragSrc = img.src;

        const rect = img.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        dragImg = img.cloneNode(true);
        dragImg.style.position="absolute";
        dragImg.style.zIndex=999;
        dragImg.style.left=rect.left+"px";
        dragImg.style.top=rect.top+"px";
        dragImg.style.pointerEvents="none";

        document.body.appendChild(dragImg);

        activeSlotId = targetId;
        activeClearFunc = clearFunc || null;
      });
    });
  }

  document.addEventListener("mousemove", e=>{
    if(!dragImg) return;
    dragImg.style.left = (e.clientX-offsetX)+"px";
    dragImg.style.top  = (e.clientY-offsetY)+"px";
  });

  document.addEventListener("mouseup", e=>{
    if(!dragImg) return;

    const R = playerBase.getBoundingClientRect();
    const inside =
      e.clientX>R.left && e.clientX<R.right &&
      e.clientY>R.top  && e.clientY<R.bottom;

    if (inside && activeSlotId){
      const slot = document.getElementById(activeSlotId);
      if (slot) {
        pushHistory();
        if (activeClearFunc) activeClearFunc();
        slot.src = dragSrc;

        // âœ… ê°€ë°œ ì²« ì°©ìš© 1íšŒë§Œ íŠ¸ë¼ìš°ë§ˆ + ì „ìš© ì‚¬ìš´ë“œ
        if (activeSlotId === "wearWig") {
          if (!firstWigTraumaPlayed) {
            firstWigTraumaPlayed = true;

            triggerWigCaterpillar(dragSrc);

            if (wigTraumaSfx) {
              wigTraumaSfx.currentTime = 0;
              wigTraumaSfx.play().catch(()=>{});
            }
          }
          // âœ… ê°€ë°œ ì°©ìš© ì‹œ clickSfxëŠ” ì•„ì˜ˆ ì¬ìƒ ì•ˆ í•¨
        }

        // âœ… ë“œë ˆìŠ¤ ì²« ì°©ìš© íŠ¸ë¼ìš°ë§ˆ(ì˜ìƒ+ëŒ€í™”ì°½)
        else if (activeSlotId === "wearDress") {
          if (!firstDressTraumaPlayed) {
            firstDressTraumaPlayed = true;
            startDressTrauma();
          } else {
            // 1íšŒ ì´í›„ì—” ê·¸ëƒ¥ ì¼ë°˜ ì°©ìš©ìŒë§Œ
            if (clickSfx) {
              clickSfx.currentTime = 0;
              clickSfx.play().catch(()=>{});
            }
          }
        }

        else {
          // âœ… ë‹¤ë¥¸ ì•„ì´í…œì€ ê¸°ì¡´ ì°©ìš© íš¨ê³¼ìŒ ìœ ì§€
          if (clickSfx) {
            clickSfx.currentTime = 0;
            clickSfx.play().catch(()=>{});
          }
        }
      }
    }

    // ë“œë˜ê·¸ ì •ë¦¬
    dragImg.remove();
    dragImg=null;
    dragSrc="";
    activeSlotId=null;
    activeClearFunc=null;
  });

  /* ì ìš© ê·œì¹™ */
  setupDrag(".wigImg", "wearWig");
  setupDrag(".dressImg", "wearDress", ()=>{ wearTop.src=""; wearBottom.src=""; });
  setupDrag(".topImg", "wearTop", ()=>{ wearDress.src=""; });
  setupDrag(".bottomImg", "wearBottom", ()=>{ wearDress.src=""; });
  setupDrag(".shoesImg", "wearShoes");
  setupDrag(".accImg", "wearAcc");

  /* =======================
   âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ (ì´ë¯¸ì§€ ë²„ì „)
======================= */
/* =======================
   âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ (ì´ë¯¸ì§€ + ëŒ€í™”)
======================= */
const dressTraumaOverlay  = document.getElementById("dressTraumaOverlay");
const dressTraumaDialogue = document.getElementById("dressTraumaDialogue");
const dressTraumaName     = document.getElementById("dressTraumaName");
const dressTraumaText     = document.getElementById("dressTraumaText");

let firstDressTraumaPlayed = false;

function startDressTrauma(){
  if (!dressTraumaOverlay || !dressTraumaDialogue) return;

    // âœ… ë“œë ˆìŠ¤ íŠ¸ë¼ìš°ë§ˆ íš¨ê³¼ìŒ
  if (dressTraumaSfx) {
    dressTraumaSfx.currentTime = 0;
    dressTraumaSfx.play().catch(()=>{});
  }

  // âœ… ì˜¤ë²„ë ˆì´ ON
  dressTraumaOverlay.style.display = "block";
  dressTraumaDialogue.style.display = "flex";

  const lines = [
    { name: "ì›ë¹ˆ", text: "ê·¸ ë©ì²­í•œ ë“œë ˆìŠ¤ë¥¼ ì…ê³  ë‹¤ì‹œ íŒŒí‹°ì— ì˜¨ë‹¤ê³ ?" },
    { name: "ì›ë¹ˆ", text: "ê±°ìš¸ë„ ì•ˆ ë³´ê³  ë°–ì— ë‚˜ì˜¤ëŠ” ê±°ì•¼?" }
  ];

  let idx = 0;
  render();

  function render(){
    dressTraumaName.textContent = lines[idx].name;
    dressTraumaText.textContent = lines[idx].text;
  }

  // âœ… ëŒ€í™”ì°½ í´ë¦­ìœ¼ë¡œ ì§„í–‰
  dressTraumaDialogue.onclick = () => {
    idx++;
    if (idx >= lines.length){
      endDressTrauma();
      return;
    }
    render();
  };
}

function endDressTrauma(){
  if (!dressTraumaOverlay || !dressTraumaDialogue) return;

  dressTraumaOverlay.style.display = "none";
  dressTraumaDialogue.style.display = "none";
  dressTraumaDialogue.onclick = null;
}

  /* =======================
     ì™¸ì¶œí•˜ê¸° ë²„íŠ¼ í‘œì‹œ
  ======================= */
  function updateGoOutVisibility() {
    const hasItem =
      (wearWig.src && wearWig.src.trim() !== "") ||
      (wearDress.src && wearDress.src.trim() !== "") ||
      (wearTop.src && wearTop.src.trim() !== "") ||
      (wearBottom.src && wearBottom.src.trim() !== "") ||
      (wearShoes.src && wearShoes.src.trim() !== "") ||
      (wearAcc.src && wearAcc.src.trim() !== "");

    goOutWrapper.style.display = hasItem ? "block" : "none";
  }
  setInterval(updateGoOutVisibility, 200);

  /* =======================
     âœ… ì™¸ì¶œí•˜ê¸°: í‰ê°€ ì‚­ì œ ë²„ì „
  ======================= */
  function saveOutfitToStorage(){
    localStorage.setItem("wearWig", wearWig.src || "");
    localStorage.setItem("wearDress", wearDress.src || "");
    localStorage.setItem("wearTop", wearTop.src || "");
    localStorage.setItem("wearBottom", wearBottom.src || "");
    localStorage.setItem("wearShoes", wearShoes.src || "");
    localStorage.setItem("wearAcc", wearAcc.src || "");
  }

  goOutButton.addEventListener("click", ()=>{
    saveOutfitToStorage();
    window.location.href = "partyScene.html";
  });
</script>

</body>
</html>